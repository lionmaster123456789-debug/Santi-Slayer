<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer - Ultimate Master 2026</title>
    <style>
        body { margin: 0; background: #050505; color: white; font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; user-select: none; }
        canvas { display: block; background: #143d21; }
        
        /* UI Overlays */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #stats-hud { 
            position: absolute; top: 20px; left: 20px; 
            background: rgba(0,0,0,0.85); padding: 25px; border-radius: 15px; 
            border: 2px solid #f1c40f; min-width: 280px; box-shadow: 0 0 30px rgba(0,0,0,0.7); 
        }
        .xp-container { width: 100%; height: 16px; background: #222; border-radius: 8px; margin: 12px 0; border: 1px solid #444; overflow: hidden; }
        #xp-bar { height: 100%; background: linear-gradient(90deg, #3498db, #a29bfe); width: 0%; transition: width 0.4s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        
        #slot-container { display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap; max-width: 350px; }
        .slot { 
            width: 45px; height: 45px; border: 2px solid #f1c40f; background: #111; 
            display: flex; align-items: center; justify-content: center; font-size: 24px; 
            border-radius: 10px; position: relative; box-shadow: inset 0 0 10px #000;
        }
        .slot span { position: absolute; bottom: -2px; right: 3px; font-size: 12px; color: #00ff00; font-weight: 900; }
        
        /* Buttons */
        .btn-rhino { 
            position: absolute; top: 20px; right: 20px; pointer-events: all;
            padding: 15px 30px; background: #c0392b; color: white; text-decoration: none; 
            border-radius: 12px; font-weight: bold; border: 4px solid #ffffff; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .btn-rhino:hover { background: #e74c3c; transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 25px rgba(0,0,0,0.6); }

        /* Level Up Menu */
        #upgrade-screen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; 
            z-index: 9999; pointer-events: all;
        }
        #upgrade-window { 
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%); 
            padding: 50px; border-radius: 30px; border: 6px solid #f1c40f; 
            text-align: center; width: 850px; box-shadow: 0 0 100px #000;
        }
        .upgrade-row { display: flex; justify-content: center; gap: 25px; margin-top: 40px; }
        .upgrade-option { 
            background: #34495e; padding: 30px; border-radius: 20px; cursor: pointer; 
            width: 220px; border: 3px solid transparent; transition: 0.4s;
            display: flex; flex-direction: column; align-items: center;
        }
        .upgrade-option:hover { background: #1abc9c; border-color: #fff; transform: scale(1.1); }
        .upgrade-option i { font-size: 60px; margin-bottom: 20px; }
        .upgrade-option b { font-size: 20px; color: #f1c40f; margin-bottom: 10px; }
        .upgrade-option p { font-size: 13px; color: #bdc3c7; line-height: 1.4; margin: 0; }
        
        #hp-num { font-size: 20px; font-weight: bold; color: #ff7675; text-shadow: 1px 1px #000; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div id="stats-hud">
            <div style="font-size: 28px; color: #f1c40f; font-weight: 900; letter-spacing: 2px;">SANTI SLAYER</div>
            <div class="xp-container"><div id="xp-bar"></div></div>
            <div id="hp-num">HP: <span id="cur-hp">100</span> / <span id="max-hp">100</span></div>
            <div style="font-size: 15px; margin-top: 8px; color: #bdc3c7;">
                STUFE: <span id="lvl-txt">1</span> | TIME: <span id="time-txt">0</span>s<br>
                BESIEGT: <span id="score-txt">0</span>
            </div>
            <div id="slot-container"></div>
        </div>

        <a href="https://rhinogamescom.wordpress.com" class="btn-rhino">‚¨Ö GET BACK TO RHINO</a>
    </div>

    <div id="upgrade-screen">
        <div id="upgrade-window">
            <h1 style="margin:0; color: #f1c40f; font-size: 45px; text-transform: uppercase;">Macht-Aufstieg!</h1>
            <p style="font-size: 18px; color: #ecf0f1;">W√§hle eine neue Gabe oder verst√§rke dein Arsenal:</p>
            <div class="upgrade-row" id="upgrade-container"></div>
        </div>
    </div>

    <script>
        /**
         * SANTI SLAYER - DEFINITIVE EDITION (v3.5 - 2026)
         * Engine: Custom JS Pixel-Rogue 
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const WORLD = 6000; // Gr√∂√üere Welt
        let cw, ch;

        // --- Core Player Data ---
        let player = {
            x: WORLD/2, y: WORLD/2,
            targetX: WORLD/2, targetY: WORLD/2,
            spd: 5.5, hp: 100, maxHp: 100,
            xp: 0, nextXp: 100, lvl: 1,
            kills: 0, tStart: Date.now(),
            rad: 32, angle: 0, anim: 0, slots: []
        };

        let cam = { x: 0, y: 0 };
        let input = {};
        let enemies = [], bullets = [], crystals = [], props = [], vfx = [];
        let running = true;
        let timers = { shot: 0, bolt: 0, spawn: 0, regen: 0, aura: 0 };
        let skills = {}; 

        // --- Die 20 Skills & Logik ---
        const DATABASE = [
            {id:'fire', n:'Schnellschuss', i:'üèπ', d:'Erh√∂ht die Feuerrate deiner automatischen Pfeile.'},
            {id:'bolt', n:'Kettenblitz', i:'‚ö°', d:'Blitze springen auf zuf√§llige Gegner in der N√§he √ºber.'},
            {id:'bunny', n:'Kampfhase', i:'üêá', d:'Ein loyaler Hase umkreist dich und rammt Feinde.'},
            {id:'spd', n:'Windschuhe', i:'üëü', d:'Erh√∂ht dein dauerhaftes Lauftempo.'},
            {id:'reg', n:'Lebenskraft', i:'üçé', d:'Heilt dich sofort und regeneriert HP √ºber Zeit.'},
            {id:'arm', n:'Plattenr√ºstung', i:'üõ°Ô∏è', d:'Reduziert erlittenen Schaden massiv.'},
            {id:'aoe', n:'Sprengpfeile', i:'üí£', d:'Deine Geschosse explodieren beim Aufprall.'},
            {id:'mag', n:'XP-Magnet', i:'üß≤', d:'Sammelt Kristalle aus weitaus gr√∂√üerer Entfernung ein.'},
            {id:'vamp', n:'Vampirbiss', i:'üßõ', d:'Chance, bei jedem besiegten Gegner HP zu stehlen.'},
            {id:'ice', n:'Frosthauch', i:'‚ùÑÔ∏è', d:'Gegner in deiner N√§he werden stark verlangsamt.'},
            {id:'poi', n:'Giftsumpf', i:'üß™', d:'Hinterlasse eine Spur, die Gegner vergiftet.'},
            {id:'crit', n:'Scharfsch√ºtze', i:'üéØ', d:'Gew√§hrt eine Chance auf kritischen, doppelten Schaden.'},
            {id:'ring', n:'Feuerring', i:'üî•', d:'Ein permanenter Flammenkreis verbrennt nahe Feinde.'},
            {id:'gold', n:'Gl√ºcksfund', i:'üí∞', d:'Besiegte Gegner geben mehr XP-Kristalle.'},
            {id:'size', n:'Titanenwuchs', i:'üêò', d:'Du wirst gr√∂√üer, st√§rker und hast mehr maximale HP.'},
            {id:'mult', n:'Multischuss', i:'‚ú®', d:'Feuere zus√§tzliche Pfeile in verschiedene Richtungen.'},
            {id:'dash', n:'Phantom-Dash', i:'üåÄ', d:'Regelm√§√üiger kurzer Speed-Boost mit Unverwundbarkeit.'},
            {id:'shrd', n:'Splitterglas', i:'üíé', d:'Get√∂tete Gegner explodieren in scharfe Splitter.'},
            {id:'wall', n:'Erdwall', i:'üß±', d:'Blockiert gelegentlich gegnerische Projektile/Angriffe.'},
            {id:'luck', n:'Schicksal', i:'üçÄ', d:'Erh√∂ht die Chance auf seltene Upgrades im Men√º.'}
        ];

        // --- Die 15 Gegner Definitionen ---
        const BESTIARY = [
            {n:'Waldwurm', c:'#2ecc71', s:12, h:12, sp:2.2, t:'worm'},
            {n:'Riesenspinne', c:'#2c3e50', s:18, h:25, sp:3.8, t:'spider'},
            {n:'Eisenwolf', c:'#7f8c8d', s:26, h:50, sp:4.2, t:'beast'},
            {n:'Stachelschwein', c:'#a04000', s:22, h:45, sp:3.0, t:'spiky'},
            {n:'Gras-Skorpion', c:'#d35400', s:24, h:80, sp:3.2, t:'scout'},
            {n:'Sumpf-Hydra', c:'#196f3d', s:35, h:150, sp:2.4, t:'worm'},
            {n:'Felsengolem', c:'#34495e', s:55, h:500, sp:1.2, t:'rock'},
            {n:'Waldschrat', c:'#1b5e20', s:40, h:200, sp:2.5, t:'beast'},
            {n:'Schattenl√§ufer', c:'#111', s:20, h:120, sp:5.5, t:'shadow'},
            {n:'Feuerschlange', c:'#e67e22', s:28, h:250, sp:3.5, t:'worm'},
            {n:'D√§monischer Eber', c:'#c0392b', s:38, h:400, sp:3.8, t:'beast'},
            {n:'Frost-Riese', c:'#d6eaf8', s:60, h:1200, sp:1.5, t:'rock'},
            {n:'Giftiger Mantikor', c:'#8e44ad', s:32, h:600, sp:3.4, t:'spiky'},
            {n:'Eldritch-Auge', c:'#fff', s:45, h:800, sp:3.0, t:'boss_minion'},
            {n:'SANTI-KILLER (GOD)', c:'#fff', s:90, h:8000, sp:2.0, t:'god'}
        ];

        // --- Initialisierung ---
        function init() {
            window.addEventListener('keydown', e => input[e.key.toLowerCase()] = true);
            window.addEventListener('keyup', e => input[e.key.toLowerCase()] = false);
            window.addEventListener('resize', resize);
            resize();

            // Welt-Deko (V2 Map Style)
            for(let i=0; i<180; i++) {
                props.push({
                    x: Math.random()*WORLD, y: Math.random()*WORLD,
                    t: Math.random()>0.5?'tree':'stone',
                    sz: 30+Math.random()*50,
                    seed: Math.random()*100
                });
            }
            updateHUD();
            requestAnimationFrame(gameLoop);
        }

        function resize() { cw = canvas.width = window.innerWidth; ch = canvas.height = window.innerHeight; }

        function spawn() {
            if(!running) return;
            let time = (Date.now() - player.tStart)/1000;
            let level = Math.min(14, Math.floor(time / 20));
            let data = BESTIARY[level];

            let a = Math.random()*Math.PI*2;
            let dist = 1000;
            let x = player.x + Math.cos(a)*dist;
            let y = player.y + Math.sin(a)*dist;

            enemies.push({
                ...data, x, y, curHp: data.h, maxHp: data.h,
                seg: Array(data.t==='worm'?12:0).fill({x,y}),
                anim: Math.random()*10,
                slowed: 0
            });
        }

        // --- Player Render Model ---
        function drawHero(ctx, p) {
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.angle);

            // Umhang (dynamisch)
            ctx.fillStyle = '#c0392b';
            ctx.beginPath();
            ctx.moveTo(-15, 0); ctx.lineTo(-40, 25); ctx.lineTo(-40, -25); ctx.closePath(); ctx.fill();

            // K√∂rperpanzerung
            ctx.fillStyle = '#2980b9';
            ctx.beginPath(); ctx.arc(0, 0, p.rad, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#1a5276'; ctx.lineWidth = 4; ctx.stroke();

            // Ritterhelm
            ctx.fillStyle = '#bdc3c7';
            ctx.beginPath(); ctx.arc(0, 0, p.rad*0.8, Math.PI*1, Math.PI*2); ctx.fill();
            ctx.fillStyle = '#f1c40f'; // Visier-Schlitz
            ctx.fillRect(-12, -8, 24, 5);

            // Arme & Waffe
            let w = Math.sin(p.anim * 0.15) * 6;
            ctx.fillStyle = '#ecf0f1';
            ctx.beginPath(); ctx.arc(25, 20+w, 10, 0, 6.28); ctx.fill(); // Hand
            ctx.fillStyle = '#515a5a'; ctx.fillRect(25, 15+w, 35, 10); // Waffenlauf

            ctx.restore();
        }

        // --- Enemy Render Models (15 Typen) ---
        function drawEnemy(ctx, en) {
            ctx.fillStyle = en.c;
            en.anim += 0.1;
            
            if(en.t === 'worm') {
                en.seg.forEach((s, i) => {
                    ctx.beginPath(); ctx.arc(s.x, s.y, en.s*(1-i/18), 0, 6.28); ctx.fill();
                });
            } else if(en.t === 'spider') {
                ctx.beginPath(); ctx.arc(en.x, en.y, en.s, 0, 6.28); ctx.fill();
                for(let i=0; i<8; i++) {
                    let a = i * (Math.PI/4) + Math.sin(en.anim)*0.3;
                    ctx.lineWidth = 3; ctx.strokeStyle = en.c;
                    ctx.beginPath(); ctx.moveTo(en.x, en.y); ctx.lineTo(en.x+Math.cos(a)*en.s*1.8, en.y+Math.sin(a)*en.s*1.8); ctx.stroke();
                }
            } else if(en.t === 'rock') {
                ctx.beginPath(); ctx.roundRect(en.x-en.s, en.y-en.s, en.s*2, en.s*2, 10); ctx.fill();
                ctx.fillStyle = "rgba(255,255,255,0.2)"; ctx.fillRect(en.x-en.s/2, en.y-en.s/2, en.s, en.s);
            } else if(en.t === 'spiky') {
                ctx.beginPath(); ctx.arc(en.x, en.y, en.s, 0, 6.28); ctx.fill();
                for(let i=0; i<12; i++) {
                    let a = i * (Math.PI/6);
                    ctx.beginPath(); ctx.moveTo(en.x, en.y); ctx.lineTo(en.x+Math.cos(a)*en.s*1.5, en.y+Math.sin(a)*en.s*1.5); ctx.stroke();
                }
            } else {
                // Beast/Shadow Base
                ctx.beginPath(); ctx.arc(en.x, en.y, en.s, 0, 6.28); ctx.fill();
                ctx.fillStyle = 'red'; ctx.beginPath(); ctx.arc(en.x-en.s/2, en.y-5, 4, 0, 6.28); ctx.fill();
                ctx.beginPath(); ctx.arc(en.x+en.s/2, en.y-5, 4, 0, 6.28); ctx.fill();
            }

            // Health Bar
            ctx.fillStyle = '#000'; ctx.fillRect(en.x-25, en.y-en.s-20, 50, 6);
            ctx.fillStyle = '#e74c3c'; ctx.fillRect(en.x-25, en.y-en.s-20, 50*(en.curHp/en.h), 6);
        }

        // --- Skill-System Upgrade Auswahl ---
        function levelUpMenu() {
            running = false;
            document.getElementById('upgrade-screen').style.display = 'flex';
            const cont = document.getElementById('upgrade-container');
            cont.innerHTML = '';

            let choices = [...DATABASE].sort(() => 0.5 - Math.random()).slice(0, 3);
            choices.forEach(s => {
                let lv = skills[s.id] || 0;
                let div = document.createElement('div');
                div.className = 'upgrade-option';
                div.innerHTML = `<i>${s.i}</i><b>${s.n} (Rang ${lv+1})</b><p>${s.d}</p>`;
                div.onclick = () => {
                    if(!skills[s.id]) {
                        if(player.slots.length < 8) player.slots.push(s);
                        else { alert("Slots voll!"); return; }
                    }
                    skills[s.id] = lv + 1;
                    if(s.id==='reg') { player.hp = Math.min(player.maxHp, player.hp+40); }
                    if(s.id==='size') { player.maxHp += 40; player.hp += 40; player.rad += 4; }
                    
                    document.getElementById('upgrade-screen').style.display = 'none';
                    running = true;
                    updateHUD(); window.focus();
                    requestAnimationFrame(gameLoop);
                };
                cont.appendChild(div);
            });
        }

        function updateHUD() {
            document.getElementById('xp-bar').style.width = (player.xp/player.nextXp*100)+'%';
            document.getElementById('cur-hp').innerText = Math.floor(player.hp);
            document.getElementById('max-hp').innerText = player.maxHp;
            document.getElementById('lvl-txt').innerText = player.lvl;
            document.getElementById('score-txt').innerText = player.kills;
            document.getElementById('time-txt').innerText = Math.floor((Date.now()-player.tStart)/1000);
            
            const slotUI = document.getElementById('slot-container');
            slotUI.innerHTML = '';
            player.slots.forEach(s => {
                slotUI.innerHTML += `<div class="slot">${s.i}<span>${skills[s.id]}</span></div>`;
            });
        }

        // --- Main Game Engine ---
        function gameLoop() {
            if(!running) return;

            // Input & Movement
            let mx = 0, my = 0;
            if(input['w']) my = -1; if(input['s']) my = 1;
            if(input['a']) mx = -1; if(input['d']) mx = 1;
            
            if(mx !== 0 || my !== 0) {
                let mag = Math.hypot(mx, my);
                let moveSpd = player.spd + (skills.spd||0)*0.8;
                player.x += (mx/mag)*moveSpd; player.y += (my/mag)*moveSpd;
                player.angle = Math.atan2(my, mx);
                player.anim++;
            }

            // World Bound
            player.x = Math.max(0, Math.min(WORLD, player.x));
            player.y = Math.max(0, Math.min(WORLD, player.y));
            cam.x = player.x - cw/2; cam.y = player.y - ch/2;

            // Timer & Spawns
            timers.spawn++;
            if(timers.spawn > 45) { spawn(); timers.spawn = 0; }

            // Regen Skill
            if(skills.reg) {
                timers.regen++;
                if(timers.regen > 100) { player.hp = Math.min(player.maxHp, player.hp + skills.reg); timers.regen = 0; updateHUD(); }
            }

            // Aura Skill
            if(skills.ring) {
                timers.aura++;
                enemies.forEach(en => {
                    if(Math.hypot(en.x-player.x, en.y-player.y) < 150) en.curHp -= 0.2 * skills.ring;
                });
            }

            // Auto Attack (In View Range)
            if(Date.now() - timers.shot > 700 / (skills.fire||1)) {
                let target = enemies.find(e => Math.hypot(e.x-player.x, e.y-player.y) < 600);
                if(target) {
                    let a = Math.atan2(target.y-player.y, target.x-player.x);
                    bullets.push({x:player.x, y:player.y, vx:Math.cos(a)*16, vy:Math.sin(a)*16, life:80, power: 10 + (skills.aoe?10:0)});
                    timers.shot = Date.now();
                }
            }

            // Lightning Bolt
            if(skills.bolt && Date.now() - timers.bolt > 3500/skills.bolt) {
                let t = enemies.find(e => Math.hypot(e.x-player.x, e.y-player.y) < 500);
                if(t) {
                    t.curHp -= 40 * skills.bolt;
                    vfx.push({x1:player.x, y1:player.y, x2:t.x, y2:t.y, t:12});
                    timers.bolt = Date.now();
                }
            }

            // Logic Updates (Physics & Collision)
            bullets.forEach((b, i) => {
                b.x += b.vx; b.y += b.vy; b.life--;
                enemies.forEach(en => {
                    if(Math.hypot(b.x-en.x, b.y-en.y) < en.s+10) {
                        en.curHp -= b.power + (skills.crit && Math.random()>0.8 ? 50:0);
                        b.life = 0;
                    }
                });
                if(b.life <= 0) bullets.splice(i, 1);
            });

            enemies.forEach((en, i) => {
                let dist = Math.hypot(player.x-en.x, player.y-en.y);
                let speedMod = en.slowed ? 0.5 : 1;
                if(skills.ice && dist < 200) speedMod = 0.4; // Ice Skill logik

                let a = Math.atan2(player.y-en.y, player.x-en.x);
                en.x += Math.cos(a)*en.sp*speedMod; en.y += Math.sin(a)*en.sp*speedMod;
                
                if(en.t === 'worm') { en.seg.unshift({x:en.x, y:en.y}); en.seg.pop(); }
                if(dist < player.rad + en.s) { player.hp -= (0.6 / (skills.arm||1)); updateHUD(); }
                
                if(en.curHp <= 0) {
                    if(skills.vamp && Math.random()>0.7) player.hp = Math.min(player.maxHp, player.hp+5);
                    crystals.push({x:en.x, y:en.y, val: 30 * (skills.gold?1.6:1)});
                    enemies.splice(i, 1); player.kills++; updateHUD();
                    if(skills.shrd) { /* Splitter Effekt hier */ }
                }
            });

            crystals.forEach((c, i) => {
                let d = Math.hypot(player.x-c.x, player.y-c.y);
                let magnet = 150 + (skills.mag||0)*80;
                if(d < magnet) {
                    c.x += (player.x-c.x)*0.2; c.y += (player.y-c.y)*0.2;
                    if(d < 25) {
                        player.xp += c.val; crystals.splice(i, 1);
                        if(player.xp >= player.nextXp) { player.lvl++; player.xp=0; player.nextXp*=1.35; levelUpMenu(); }
                        updateHUD();
                    }
                }
            });

            if(player.hp <= 0) { alert("Das Ende von Santi Slayer! Punkte: " + player.kills); location.reload(); }

            render();
            requestAnimationFrame(gameLoop);
        }

        function render() {
            cw = canvas.width = window.innerWidth; ch = canvas.height = window.innerHeight;
            ctx.clearRect(0,0,cw,ch);
            ctx.save(); ctx.translate(-cam.x, -cam.y);
            
            // Map Drawing
            ctx.strokeStyle='rgba(0,0,0,0.15)'; ctx.lineWidth=2;
            for(let x=0; x<WORLD; x+=300) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,WORLD); ctx.stroke(); }
            for(let y=0; y<WORLD; y+=300) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(WORLD,y); ctx.stroke(); }
            ctx.strokeStyle='#c0392b'; ctx.lineWidth=15; ctx.strokeRect(0,0,WORLD,WORLD);

            props.forEach(p => {
                ctx.fillStyle = p.t==='tree'?'#145a32':'#5d6d7e';
                ctx.beginPath(); ctx.arc(p.x, p.y, p.sz, 0, 6.28); ctx.fill();
            });

            if(skills.ring) { // Aura Visual
                ctx.strokeStyle = "rgba(231, 76, 60, 0.3)"; ctx.lineWidth = 5;
                ctx.beginPath(); ctx.arc(player.x, player.y, 150, 0, 6.28); ctx.stroke();
            }

            crystals.forEach(c => { ctx.fillStyle='#a29bfe'; ctx.beginPath(); ctx.arc(c.x, c.y, 7, 0, 6.28); ctx.fill(); });
            vfx.forEach((f, i) => { ctx.strokeStyle='cyan'; ctx.lineWidth=5; ctx.beginPath(); ctx.moveTo(f.x1, f.y1); ctx.lineTo(f.x2, f.y2); ctx.stroke(); f.t--; if(f.t<0) vfx.splice(i,1); });
            
            drawHero(ctx, player);
            enemies.forEach(en => drawEnemy(ctx, en));
            ctx.fillStyle='#f1c40f'; bullets.forEach(b => { ctx.beginPath(); ctx.arc(b.x, b.y, 7, 0, 6.28); ctx.fill(); });

            ctx.restore();
        }

        init();
    </script>
</body>
</html>
