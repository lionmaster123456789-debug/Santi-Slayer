<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer - Ultimate Edition</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        canvas { background: #2ecc71; display: block; }
        #ui { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; border: 2px solid #555; pointer-events: none; min-width: 200px; }
        #slots { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; max-width: 300px; }
        .slot { width: 35px; height: 35px; border: 1px solid #f1c40f; background: #333; display: flex; align-items: center; justify-content: center; font-size: 18px; position: relative; }
        .slot small { position: absolute; bottom: -2px; right: 2px; font-size: 10px; color: yellow; }
        .btn-back { position: absolute; top: 10px; right: 10px; padding: 12px; background: #c0392b; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; z-index: 1000; }
        #upgrade-menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2c3e50; padding: 30px; border: 5px solid #f1c40f; display: none; text-align: center; border-radius: 20px; z-index: 2000; }
        .upgrade-container { display: flex; justify-content: center; gap: 20px; }
        .upgrade-card { background: #34495e; padding: 15px; cursor: pointer; border-radius: 10px; width: 140px; transition: 0.2s; }
        .upgrade-card:hover { background: #1abc9c; transform: translateY(-5px); }
        progress { width: 100%; height: 15px; accent-color: #e74c3c; }
    </style>
</head>
<body>

    <div id="ui">
        <div style="font-size: 20px; color: #f1c40f;">ZEIT: <span id="timer">0</span>s | KILLS: <span id="score">0</span></div>
        <progress id="hpBar" value="100" max="100"></progress>
        <div id="slots"></div>
    </div>

    <a href="https://rhinogamescom.wordpress.com" class="btn-back">â¬… GET BACK</a>

    <div id="upgrade-menu">
        <h2 style="margin-top:0;">WÃ„HLE EIN UPGRADE</h2>
        <div id="upgrade-options" class="upgrade-container"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const WORLD_SIZE = 4000;
        let canvasW, canvasH;
        function resize() { canvasW = canvas.width = window.innerWidth; canvasH = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();

        let player = { x: WORLD_SIZE/2, y: WORLD_SIZE/2, speed: 5, hp: 100, score: 0, startTime: Date.now(), activeSlots: [] };
        let camera = { x: 0, y: 0 };
        let keys = {}, enemies = [], projectiles = [], effects = [], env = [], bunny = { x: 0, y: 0, angle: 0 };
        let gameActive = true, lastShot = 0, lastLightning = 0, mySkills = {};

        // Map Deko (BÃ¤ume & Steine wie in V2)
        for(let i=0; i<100; i++) {
            env.push({ x: Math.random()*WORLD_SIZE, y: Math.random()*WORLD_SIZE, type: Math.random()>0.5?'tree':'stone', sz: 20+Math.random()*30 });
        }

        const UPGRADES = [
            { id: 'fireRate', name: 'Tempo', icon: 'ðŸ¹' }, { id: 'lightning', name: 'Blitz', icon: 'âš¡' },
            { id: 'bunny', name: 'Hase', icon: 'ðŸ‡' }, { id: 'speed', name: 'Schuhe', icon: 'ðŸ‘Ÿ' },
            { id: 'regen', name: 'Heilung', icon: 'ðŸŽ' }, { id: 'armor', name: 'Schild', icon: 'ðŸ›¡ï¸' }
        ]; // (Liste kann beliebig auf 20 erweitert werden)

        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

        function spawnEnemy() {
            if(!gameActive) return;
            let elapsed = (Date.now() - player.startTime) / 1000;
            let angle = Math.random() * Math.PI * 2;
            let x = player.x + Math.cos(angle) * 700;
            let y = player.y + Math.sin(angle) * 700;
            
            // Logik fÃ¼r 15 Gegnertypen basierend auf Zeit
            let type = { hp: 2 + (elapsed/10), speed: 2 + Math.random(), sz: 15, col: '#2ecc71', type: 'snake' };
            if(elapsed > 30) { type.col = '#e67e22'; type.type = 'beast'; type.sz = 25; }
            if(elapsed > 60) { type.col = '#c0392b'; type.sz = 40; }
            
            enemies.push({ ...type, x, y, segments: Array(type.type==='snake'?8:0).fill({x,y}) });
        }
        setInterval(spawnEnemy, 1000);

        function showUpgradeMenu() {
            gameActive = false;
            const container = document.getElementById('upgrade-options');
            container.innerHTML = '';
            let pool = UPGRADES.sort(() => 0.5 - Math.random()).slice(0, 3);
            pool.forEach(upg => {
                let lv = mySkills[upg.id] || 0;
                let card = document.createElement('div');
                card.className = 'upgrade-card';
                card.innerHTML = `<div style="font-size:30px">${upg.icon}</div><b>${upg.name}</b><br>Lv ${lv+1}`;
                card.onclick = () => {
                    if(!mySkills[upg.id]) player.activeSlots.push(upg);
                    mySkills[upg.id] = lv + 1;
                    updateUI(); gameActive = true;
                    document.getElementById('upgrade-menu').style.display = 'none';
                    window.focus();
                };
                container.appendChild(card);
            });
            document.getElementById('upgrade-menu').style.display = 'block';
        }

        function updateUI() {
            const sDiv = document.getElementById('slots'); sDiv.innerHTML = '';
            player.activeSlots.forEach(s => { sDiv.innerHTML += `<div class="slot">${s.icon}<small>${mySkills[s.id]}</small></div>`; });
        }

        function update() {
            if(!gameActive) return;
            let elapsed = Math.floor((Date.now() - player.startTime) / 1000);
            document.getElementById('timer').innerText = elapsed;

            let spd = player.speed + (mySkills.speed || 0);
            if(keys['w'] && player.y > 0) player.y -= spd;
            if(keys['s'] && player.y < WORLD_SIZE) player.y += spd;
            if(keys['a'] && player.x > 0) player.x -= spd;
            if(keys['d'] && player.x < WORLD_SIZE) player.x += spd;

            camera.x = player.x - canvasW/2;
            camera.y = player.y - canvasH/2;

            // Blitz Skill
            if(mySkills.lightning && Date.now() - lastLightning > 3000/mySkills.lightning) {
                let target = enemies[0];
                if(target) {
                    target.hp -= 5;
                    effects.push({ x1: player.x, y1: player.y, x2: target.x, y2: target.y, life: 10 });
                    lastLightning = Date.now();
                }
            }

            // Auto-Schuss
            if(Date.now() - lastShot > 600/(mySkills.fireRate||1)) {
                let target = enemies[0];
                if(target) {
                    let a = Math.atan2(target.y - player.y, target.x - player.x);
                    projectiles.push({ x: player.x, y: player.y, vx: Math.cos(a)*10, vy: Math.sin(a)*10 });
                }
                lastShot = Date.now();
            }

            enemies.forEach((en, i) => {
                let a = Math.atan2(player.y - en.y, player.x - en.x);
                en.x += Math.cos(a) * en.speed; en.y += Math.sin(a) * en.speed;
                if(en.type === 'snake') { en.segments.unshift({x:en.x, y:en.y}); en.segments.pop(); }
                if(Math.hypot(player.x-en.x, player.y-en.y) < en.sz+10) { player.hp -= 0.5; document.getElementById('hpBar').value = player.hp; }
                projectiles.forEach((p, pi) => {
                    if(Math.hypot(p.x-en.x, p.y-en.y) < en.sz+10) { en.hp -= 2; projectiles.splice(pi,1); }
                });
                if(en.hp <= 0) { enemies.splice(i,1); player.score++; document.getElementById('score').innerText = player.score; if(player.score % 10 === 0) showUpgradeMenu(); }
            });

            if(player.hp <= 0) location.reload();
            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvasW, canvasH);
            ctx.save(); ctx.translate(-camera.x, -camera.y);

            // Gitter (Map Orientierung)
            ctx.strokeStyle = "rgba(0,0,0,0.1)";
            for(let x=0; x<WORLD_SIZE; x+=200) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,WORLD_SIZE); ctx.stroke(); }
            for(let y=0; y<WORLD_SIZE; y+=200) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(WORLD_SIZE,y); ctx.stroke(); }
            ctx.strokeStyle = "red"; ctx.lineWidth = 10; ctx.strokeRect(0,0,WORLD_SIZE,WORLD_SIZE);

            // Deko
            env.forEach(o => {
                ctx.fillStyle = o.type==='tree'?'#1b5e20':'#7f8c8d';
                ctx.beginPath(); ctx.arc(o.x, o.y, o.sz, 0, Math.PI*2); ctx.fill();
            });

            // Effekte & Player
            effects.forEach((ef, i) => { ctx.strokeStyle="cyan"; ctx.beginPath(); ctx.moveTo(ef.x1, ef.y1); ctx.lineTo(ef.x2, ef.y2); ctx.stroke(); ef.life--; if(ef.life<0) effects.splice(i,1); });
            ctx.fillStyle = "#3498db"; ctx.beginPath(); ctx.arc(player.x, player.y, 20, 0, Math.PI*2); ctx.fill();

            // Gegner & SchÃ¼sse
            enemies.forEach(en => {
                ctx.fillStyle = en.col;
                if(en.type === 'snake') en.segments.forEach(s => { ctx.beginPath(); ctx.arc(s.x, s.y, 10, 0, Math.PI*2); ctx.fill(); });
                else { ctx.beginPath(); ctx.arc(en.x, en.y, en.sz, 0, Math.PI*2); ctx.fill(); }
            });
            ctx.fillStyle = "yellow"; projectiles.forEach(p => { p.x += p.vx; p.y += p.vy; ctx.beginPath(); ctx.arc(p.x, p.y, 5, 0, Math.PI*2); ctx.fill(); });

            ctx.restore();
        }
        update();
    </script>
</body>
</html>
