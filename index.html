<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer - Hyper-Logic Edition (1000 Lines)</title>
    <style>
        body { margin: 0; background: #020202; color: #fff; font-family: 'Consolas', monospace; overflow: hidden; user-select: none; }
        canvas { display: block; background: #0a0f0a; }
        #ui-master { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #hud-main { 
            position: absolute; top: 25px; left: 25px; background: rgba(5, 15, 5, 0.95); 
            padding: 25px; border-radius: 20px; border: 4px solid #f1c40f; min-width: 340px; 
            box-shadow: 0 0 40px #000; backdrop-filter: blur(15px); z-index: 100;
        }
        .bar-wrap { width: 100%; height: 18px; background: #111; border-radius: 9px; margin: 12px 0; border: 1px solid #333; overflow: hidden; }
        #xp-bar { height: 100%; background: linear-gradient(90deg, #00d2ff, #3a7bd5); width: 0%; transition: width 0.4s; }
        #hp-bar { height: 100%; background: linear-gradient(90deg, #ff416c, #ff4b2b); width: 100%; transition: width 0.2s; }
        #slot-grid { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .u-slot { 
            width: 55px; height: 55px; border: 2px solid #f1c40f; background: #000; 
            display: flex; align-items: center; justify-content: center; font-size: 28px; 
            border-radius: 12px; position: relative; 
        }
        .cd-mask { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.2); height: 0%; }
        .lvl-tag { position: absolute; top: -5px; right: -5px; background: #27ae60; font-size: 11px; padding: 2px 6px; border-radius: 8px; border: 1px solid #fff; }
        .back-link { 
            position: absolute; top: 25px; right: 25px; padding: 18px 36px; background: #e74c3c; 
            color: #fff; text-decoration: none; border-radius: 15px; font-weight: 900; 
            border: 4px solid #fff; pointer-events: all; transition: 0.3s; box-shadow: 0 10px 30px #000;
        }
        .back-link:hover { transform: scale(1.1) rotate(1deg); background: #ff5e57; }
        .full-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: none; align-items: center; 
            justify-content: center; z-index: 1000; pointer-events: all; backdrop-filter: blur(20px);
        }
        #up-panel { 
            background: #111; padding: 50px; border-radius: 35px; border: 8px solid #f1c40f; 
            text-align: center; width: 950px; box-shadow: 0 0 200px #000; 
        }
        .card-row { display: flex; gap: 30px; justify-content: center; margin-top: 50px; }
        .up-card { 
            background: #1a1a1a; padding: 35px; border-radius: 25px; cursor: pointer; 
            width: 260px; border: 4px solid transparent; transition: 0.4s;
        }
        .up-card:hover { border-color: #f1c40f; background: #222; transform: translateY(-25px); box-shadow: 0 30px 60px rgba(0,0,0,0.8); }
        .up-card i { font-size: 80px; display: block; margin-bottom: 20px; }
        .up-card b { color: #f1c40f; font-size: 24px; display: block; margin-bottom: 12px; }
        .up-card p { font-size: 15px; line-height: 1.6; color: #aaa; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-master">
        <div id="hud-main">
            <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                <b style="font-size: 36px; color: #f1c40f; letter-spacing: 3px; text-shadow: 2px 2px #000;">SANTI SLAYER</b>
                <span id="lvl-lbl" style="font-weight:900; background:#f1c40f; color:#000; padding:4px 14px; border-radius:8px; font-size: 20px;">LV 1</span>
            </div>
            <div class="bar-wrap"><div id="xp-bar"></div></div>
            <div class="bar-wrap" style="background:#200;"><div id="hp-bar"></div></div>
            <div style="font-size: 17px; display:flex; justify-content:space-between; font-weight:bold; color: #eee;">
                <span>VITALITÃ„T: <span id="hp-txt">100 / 100</span></span>
                <span>KILLS: <span id="score-txt">0</span></span>
            </div>
            <div id="slot-grid"></div>
        </div>
        <a href="https://rhinogamescom.wordpress.com" class="back-link">RHINO GAMES</a>
    </div>

    <div id="up-overlay" class="full-overlay">
        <div id="up-panel">
            <h1 style="color: #f1c40f; font-size: 60px; margin:0; text-shadow: 4px 4px #000;">STUFENAUFSTIEG</h1>
            <p style="font-size: 24px; color: #eee;">WÃ¤hle eine arkane Gabe zur Vernichtung der Brut:</p>
            <div id="up-container" class="card-row"></div>
        </div>
    </div>

    <script>
        /**
         * SANTI SLAYER - 1000 LINES HYPER-LOGIC ENGINE
         * ARCHITECTURE: MODULAR ENTITY & SKILL SYSTEM
         */
        
        // --- 1. CORE CONFIG & CONSTANTS ---
        const cfg = {
            worldSize: 8000,
            camEase: 0.1,
            spawnRate: 750,
            gemValue: 35,
            maxSlots: 8
        };

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let cw, ch;

        // --- 2. GAME STATE ---
        const state = {
            running: true,
            tick: 0,
            lastSpawn: 0,
            entities: {
                enemies: [],
                projectiles: [],
                gems: [],
                deco: [],
                fx: [],
                poisons: [],
                bunny: { x:0, y:0, a:0, active: false }
            }
        };

        const player = {
            x: cfg.worldSize/2,
            y: cfg.worldSize/2,
            hp: 100,
            maxHp: 100,
            speed: 6.0,
            xp: 0,
            nextXp: 100,
            lvl: 1,
            score: 0,
            size: 38,
            angle: 0,
            lastFire: 0,
            lastPoi: 0,
            frame: 0,
            skills: {},
            slots: []
        };

        const input = { w:0, a:0, s:0, d:0, ArrowUp:0, ArrowDown:0, ArrowLeft:0, ArrowRight:0 };
        const cam = { x: player.x, y: player.y };

        // --- 3. SKILL & ENEMY DATABASE ---
        const SKILL_DB = [
            {id:'fire', n:'Inferno-Schuss', i:'ðŸ¹', d:'Massiv erhÃ¶hte Feuerrate der Hauptwaffe.'},
            {id:'bolt', n:'Gewitterfluch', i:'âš¡', d:'Kettenblitze springen automatisch zwischen Feinden.'},
            {id:'bunny', n:'WÃ¤chter-Hase', i:'ðŸ‡', d:'Ein rammender Begleiter zerschmettert nahe Brut.'},
            {id:'spd', n:'GÃ¶tterlauf', i:'ðŸ‘Ÿ', d:'Permanente ErhÃ¶hung der Bewegungsgeschwindigkeit.'},
            {id:'reg', n:'Lebensquell', i:'ðŸŽ', d:'Sofortige Heilung und mÃ¤chtige HP-Regeneration.'},
            {id:'arm', n:'Obsidian-Panzer', i:'ðŸ›¡ï¸', d:'Verringert jeglichen erlittenen Schaden drastisch.'},
            {id:'aoe', n:'Nova-Knall', i:'ðŸ’£', d:'Projektile lÃ¶sen gewaltige FlÃ¤chenexplosionen aus.'},
            {id:'mag', n:'Seelen-Magnet', i:'ðŸ§²', d:'Zieht Edelsteine aus dem gesamten Sichtbereich an.'},
            {id:'vamp', n:'Blutdurst', i:'ðŸ§›', d:'Chance bei Kills verlorene Lebenskraft zu rauben.'},
            {id:'ice', n:'Nullpunkt', i:'â„ï¸', d:'Verlangsamt Gegner in deiner NÃ¤he durch absolute KÃ¤lte.'},
            {id:'poi', n:'Toxin-Spur', i:'ðŸ§ª', d:'HinterlÃ¤sst giftige Wolken, die Leben zersetzen.'},
            {id:'crit', n:'PrÃ¤zision', i:'ðŸŽ¯', d:'Chance auf verheerende kritische Treffer (3x Schaden).'},
            {id:'ring', n:'HÃ¶llenring', i:'ðŸ”¥', d:'Ein Flammenwirbel rÃ¶stet alles um dich herum.'},
            {id:'gold', n:'Aura der Gier', i:'ðŸ’°', d:'Gegner lassen weitaus mÃ¤chtigere Edelsteine fallen.'},
            {id:'size', n:'Koloss-Form', i:'ðŸ˜', d:'ErhÃ¶ht maximale VitalitÃ¤t und Angriffsreichweite.'},
            {id:'mult', n:'Splitterschuss', i:'âœ¨', d:'Feuert zusÃ¤tzliche Projektile in alle Richtungen.'},
            {id:'dash', n:'Ã„ther-Dash', i:'ðŸŒ€', d:'Schneller Sprung nach vorn bei Richtungswechsel.'},
            {id:'shrd', n:'Knochensplitter', i:'ðŸ’Ž', d:'Besiegte Feinde explodieren in scharfe Splitter.'},
            {id:'wall', n:'Titanenwall', i:'ðŸ§±', d:'Erzeugt Barrikaden, die Monster physisch aufhalten.'},
            {id:'luck', n:'Schicksals-Gunst', i:'ðŸ€', d:'ErhÃ¶ht die QualitÃ¤t zukÃ¼nftiger Upgrade-Wahlen.'}
        ];

        const MOB_MODELS = [
            {n:'Schattenwurm', c:'#2ecc71', h:30, s:2.5, m:'snake'},
            {n:'Moosnatter', c:'#27ae60', h:60, s:2.8, m:'snake'},
            {n:'Stachelwolf', c:'#95a5a6', h:100, s:4.2, m:'beast'},
            {n:'Pestwespe', c:'#f1c40f', h:40, s:6.0, m:'fly'},
            {n:'EisenbÃ¤r', c:'#5d4037', h:350, s:1.8, m:'bear'},
            {n:'Skorpion', c:'#d35400', h:200, s:3.4, m:'insect'},
            {n:'DÃ¤moneneber', c:'#795548', h:150, s:4.8, m:'beast'},
            {n:'Basaltgolem', c:'#34495e', h:1200, s:1.2, m:'golem'},
            {n:'Phantom', c:'#fff', h:250, s:5.0, t:0.5, m:'wraith'},
            {n:'Sumpf-UngetÃ¼m', c:'#1b5e20', h:800, s:2.2, m:'giant'},
            {n:'Feuer-FÃ¼rst', c:'#c0392b', h:1000, s:3.8, m:'demon'},
            {n:'Abgrund-Tentakel', c:'#8e44ad', h:600, s:2.8, m:'horror'},
            {n:'Eis-Viper', c:'#d6eaf8', h:500, s:4.5, m:'snake'},
            {n:'Drachen-Brut', c:'#16a085', h:2000, s:3.5, m:'dragon'},
            {n:'DER SANTI-GOD', c:'#f1c40f', h:50000, s:2.5, m:'ultimate'}
        ];

        // --- 4. ENGINE INITIALIZATION ---
        function init() {
            window.addEventListener('keydown', e => { if(input.hasOwnProperty(e.key)) input[e.key] = true; });
            window.addEventListener('keyup', e => { if(input.hasOwnProperty(e.key)) input[e.key] = false; });
            window.addEventListener('resize', resize);
            resize();

            // Dekoration & Map-Struktur
            for(let i=0; i<300; i++) {
                state.entities.deco.push({
                    x: Math.random()*cfg.worldSize, y: Math.random()*cfg.worldSize,
                    t: Math.random()>0.5 ? 'tree' : 'rock',
                    sz: 50 + Math.random()*80, rot: Math.random()*Math.PI*2
                });
            }

            // Kamera-Sync
            cam.x = player.x - cw/2;
            cam.y = player.y - ch/2;

            updateUI();
            requestAnimationFrame(mainLoop);
        }

        function resize() {
            cw = canvas.width = window.innerWidth;
            ch = canvas.height = window.innerHeight;
        }

        function spawn() {
            if(!state.running) return;
            const timeElapsed = (Date.now() - player.startTime) / 1000;
            const tier = Math.min(14, Math.floor(timeElapsed / 30));
            const data = MOB_MODELS[tier];
            
            const angle = Math.random() * Math.PI * 2;
            const dist = 1200;
            const spawnX = player.x + Math.cos(angle) * dist;
            const spawnY = player.y + Math.sin(angle) * dist;

            state.entities.enemies.push({
                ...data,
                x: spawnX, y: spawnY,
                curHp: data.h + (player.lvl * 25),
                maxHp: data.h + (player.lvl * 25),
                spd: data.s + (tier * 0.15),
                sz: 30 + (tier * 5),
                segments: data.m === 'snake' ? Array(18).fill({x: spawnX, y: spawnY}) : [],
                tick: Math.random() * 100,
                alpha: 1.0
            });
        }
        setInterval(spawn, cfg.spawnRate);

        function levelUp() {
            state.running = false;
            const overlay = document.getElementById('up-overlay');
            const container = document.getElementById('up-container');
            overlay.style.display = 'flex';
            container.innerHTML = '';

            const choices = [...SKILL_DB].sort(() => 0.5 - Math.random()).slice(0, 3);
            choices.forEach(s => {
                const lv = player.skills[s.id] || 0;
                const card = document.createElement('div');
                card.className = 'up-card';
                card.innerHTML = `<i>${s.i}</i><b>${s.n}</b><p>${s.d}</p><br><b style="color:#2ecc71">RANG ${lv+1}</b>`;
                card.onclick = () => {
                    if(!player.skills[s.id]) {
                        if(player.slots.length < cfg.maxSlots) player.slots.push(s);
                        else { alert("Maximal 8 Skills erlaubt!"); return; }
                    }
                    player.skills[s.id] = lv + 1;
                    
                    // Sofort-Effekte
                    if(s.id === 'reg') player.hp = Math.min(player.maxHp, player.hp + 50);
                    if(s.id === 'size') { player.maxHp += 40; player.hp += 40; player.size += 5; }
                    
                    overlay.style.display = 'none';
                    state.running = true;
                    updateUI();
                    window.focus();
                };
                container.appendChild(card);
            });
        }

        function updateUI() {
            document.getElementById('xp-bar').style.width = (player.xp/player.nextXp*100)+'%';
            document.getElementById('hp-bar').style.width = (player.hp/player.maxHp*100)+'%';
            document.getElementById('hp-txt').innerText = `${Math.floor(player.hp)} / ${player.maxHp}`;
            document.getElementById('score-txt').innerText = player.score;
            document.getElementById('lvl-lbl').innerText = `LV ${player.lvl}`;
            
            const grid = document.getElementById('slot-grid');
            grid.innerHTML = '';
            player.slots.forEach(s => {
                grid.innerHTML += `<div class="u-slot">${s.i}<div class="lvl-tag">${player.skills[s.id]}</div></div>`;
            });
        }

        // --- 5. RENDER ENGINE (DETAIL-MODELS) ---
        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            
            // Animierter Physik-Umhang (Hyper-Detail)
            const wave = Math.sin(player.frame * 0.12) * 8;
            ctx.fillStyle = '#8e1e1e';
            ctx.beginPath();
            ctx.moveTo(-15, 0);
            ctx.quadraticCurveTo(-45, 30 + wave, -70, 10 + wave);
            ctx.quadraticCurveTo(-50, 0, -70, -10 - wave);
            ctx.quadraticCurveTo(-45, -30 - wave, -15, 0);
            ctx.fill();
            ctx.strokeStyle = '#4a0c0c'; ctx.lineWidth = 2; ctx.stroke();

            ctx.rotate(player.angle);

            // HauptkÃ¶rper
            const grad = ctx.createRadialGradient(0, 0, 5, 0, 0, player.size);
            grad.addColorStop(0, '#3498db');
            grad.addColorStop(1, '#2471a3');
            ctx.fillStyle = grad;
            ctx.beginPath(); ctx.arc(0, 0, player.size, 0, 6.28); ctx.fill();
            ctx.strokeStyle = '#1b4f72'; ctx.lineWidth = 5; ctx.stroke();

            // Helm-Konstruktion
            ctx.fillStyle = '#5d6d7e';
            ctx.beginPath(); ctx.arc(0, 0, player.size*0.9, 3.14, 6.28); ctx.fill();
            ctx.fillStyle = '#f1c40f'; // GlÃ¼hendes Visier
            ctx.shadowBlur = 20; ctx.shadowColor = '#f1c40f';
            ctx.fillRect(-20, -7, 40, 7);
            ctx.shadowBlur = 0;

            // Waffen-System
            const wX = 35, wY = 25 + Math.sin(player.frame*0.18)*10;
            ctx.fillStyle = '#d4ac0d';
            ctx.beginPath(); ctx.arc(wX, wY, 12, 0, 6.28); ctx.fill(); // Faust
            ctx.fillStyle = '#85929e';
            ctx.fillRect(wX, wY - 8, 55, 16); // LegendÃ¤re Klinge
            ctx.fillStyle = '#f1c40f'; ctx.fillRect(wX + 45, wY - 8, 10, 16); // Klingen-Spitze

            ctx.restore();
        }

        function drawEnemy(en) {
            ctx.save();
            ctx.globalAlpha = en.alpha || 1;
            ctx.fillStyle = en.c;
            
            if(en.m === 'snake') {
                en.segments.forEach((seg, i) => {
                    const r = en.sz * (1 - i/22);
                    ctx.beginPath(); ctx.arc(seg.x, seg.y, r, 0, 6.28); ctx.fill();
                    if(i === 0) { // Kopf-Details
                        ctx.fillStyle = '#fff';
                        ctx.beginPath(); ctx.arc(seg.x-8, seg.y-8, 6, 0, 6.28); ctx.fill();
                        ctx.beginPath(); ctx.arc(seg.x+8, seg.y-8, 6, 0, 6.28); ctx.fill();
                        ctx.fillStyle = '#000';
                        ctx.beginPath(); ctx.arc(seg.x-8, seg.y-8, 3, 0, 6.28); ctx.fill();
                        ctx.beginPath(); ctx.arc(seg.x+8, seg.y-8, 3, 0, 6.28); ctx.fill();
                    }
                });
            } else {
                // Komplexe Biest/Boss Modelle
                ctx.shadowBlur = 15; ctx.shadowColor = en.c;
                ctx.beginPath(); ctx.arc(en.x, en.y, en.sz, 0, 6.28); ctx.fill();
                ctx.shadowBlur = 0;
                
                // Merkmale (HÃ¶rner/FlÃ¼gel)
                if(en.m === 'demon' || en.m === 'ultimate') {
                    ctx.fillStyle = '#000';
                    ctx.beginPath(); ctx.moveTo(en.x-en.sz, en.y); ctx.lineTo(en.x-en.sz-30, en.y-50); ctx.lineTo(en.x, en.y-20); ctx.fill();
                    ctx.beginPath(); ctx.moveTo(en.x+en.sz, en.y); ctx.lineTo(en.x+en.sz+30, en.y-50); ctx.lineTo(en.x, en.y-20); ctx.fill();
                }
                
                // Augen (GlÃ¼hend)
                ctx.fillStyle = '#ff0000';
                ctx.shadowBlur = 10; ctx.shadowColor = 'red';
                ctx.beginPath(); ctx.arc(en.x-14, en.y-10, 8, 0, 6.28); ctx.fill();
                ctx.beginPath(); ctx.arc(en.x+14, en.y-10, 8, 0, 6.28); ctx.fill();
                ctx.shadowBlur = 0;
            }

            // Statischer HP-Balken
            ctx.fillStyle = 'rgba(0,0,0,0.8)';
            ctx.fillRect(en.x - 40, en.y - en.sz - 35, 80, 12);
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(en.x - 40, en.y - en.sz - 35, 80 * (en.curHp / en.maxHp), 12);
            ctx.restore();
        }

        // --- 6. CORE LOGIC UPDATES ---
        function mainLoop() {
            if(state.running) {
                update();
            }
            render();
            requestAnimationFrame(mainLoop);
        }

        function update() {
            state.tick++;

            // 1. INPUT & PHYSICS
            let dx = 0, dy = 0;
            if(input.w || input.ArrowUp) dy = -1;
            if(input.s || input.ArrowDown) dy = 1;
            if(input.a || input.ArrowLeft) dx = -1;
            if(input.d || input.ArrowRight) dx = 1;

            if(dx !== 0 || dy !== 0) {
                const mag = Math.hypot(dx, dy);
                const spd = player.speed + (player.skills.spd || 0) * 1.2;
                player.x += (dx/mag) * spd;
                player.y += (dy/mag) * spd;
                player.angle = Math.atan2(dy, dx);
                player.frame++;
                
                // Skill: Dash (ðŸŒ€)
                if(player.skills.dash && state.tick % 120 === 0) {
                    player.x += (dx/mag) * 200;
                    player.y += (dy/mag) * 200;
                    state.entities.fx.push({t:'dash', x:player.x, y:player.y, l:20});
                }
            }

            // Kamera-GlÃ¤ttung
            cam.x += (player.x - cw/2 - cam.x) * cfg.camEase;
            cam.y += (player.y - ch/2 - cam.y) * cfg.camEase;

            // 2. SKILL LOGIC HANDLERS
            const now = Date.now();

            // Automatische Schuss-Logik (ðŸ¹)
            const fireCD = 700 / (player.skills.fire || 1);
            if(now - player.lastFire > fireCD) {
                let target = null, minDist = 900;
                state.entities.enemies.forEach(en => {
                    const d = Math.hypot(en.x - player.x, en.y - player.y);
                    if(d < minDist) { minDist = d; target = en; }
                });

                if(target) {
                    const a = Math.atan2(target.y - player.y, target.x - player.x);
                    const count = player.skills.mult ? 1 + Math.floor(player.skills.mult/1.2) : 1;
                    for(let i=0; i<count; i++) {
                        const spread = (i - (count-1)/2) * 0.3;
                        state.entities.projectiles.push({
                            x: player.x, y: player.y,
                            vx: Math.cos(a + spread) * 22,
                            vy: Math.sin(a + spread) * 22,
                            l: 120, 
                            dmg: 18 + (player.skills.aoe ? 15 : 0)
                        });
                    }
                    player.lastFire = now;
                }
            }

            // Kettenblitz-Logik (âš¡)
            if(player.skills.bolt && state.tick % 45 === 0) {
                let nearby = state.entities.enemies.filter(e => Math.hypot(e.x-player.x, e.y-player.y) < 700);
                if(nearby.length > 0) {
                    let t = nearby[Math.floor(Math.random()*nearby.length)];
                    t.curHp -= 50 * player.skills.bolt;
                    state.entities.fx.push({t:'bolt', x1:player.x, y1:player.y, x2:t.x, y2:t.y, l:15});
                }
            }

            // Giftnebel (ðŸ§ª)
            if(player.skills.poi && now - player.lastPoi > 2500) {
                state.entities.poisons.push({x: player.x, y: player.y, r: 120 + player.skills.poi*30, l: 300});
                player.lastPoi = now;
            }

            // 3. ENTITY UPDATES
            updateEntities();
        }

        function updateEntities() {
            // Projektile & Kollision
            state.entities.projectiles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.l--;
                state.entities.enemies.forEach(en => {
                    if(Math.hypot(p.x - en.x, p.y - en.y) < en.sz + 20) {
                        const crit = player.skills.crit && Math.random() < 0.25;
                        en.curHp -= p.dmg * (crit ? 3.0 : 1.0);
                        p.l = 0;
                        if(player.skills.aoe) state.entities.fx.push({t:'boom', x:en.x, y:en.y, r:80, l:12});
                    }
                });
                if(p.l <= 0) state.entities.projectiles.splice(i, 1);
            });

            // Gegner-KI
            state.entities.enemies.forEach((en, i) => {
                const a = Math.atan2(player.y - en.y, player.x - en.x);
                const slow = (player.skills.ice && Math.hypot(en.x - player.x, en.y - player.y) < 500) ? 0.5 : 1;
                en.x += Math.cos(a) * en.spd * slow;
                en.y += Math.sin(a) * en.spd * slow;
                
                if(en.segments) {
                    en.segments.unshift({x: en.x, y: en.y});
                    en.segments.pop();
                }

                // Schaden am Spieler (RÃ¼stung Skill ðŸ›¡ï¸)
                if(Math.hypot(player.x - en.x, player.y - en.y) < player.size + en.sz) {
                    player.hp -= (0.8 / (player.skills.arm || 1));
                }

                // Giftschaden (ðŸ§ª)
                state.entities.poisons.forEach(p => {
                    if(Math.hypot(en.x - p.x, en.y - p.y) < p.r) en.curHp -= 0.5;
                });

                if(en.curHp <= 0) {
                    // Vampire (ðŸ§›)
                    if(player.skills.vamp && Math.random() < 0.12) player.hp = Math.min(player.maxHp, player.hp + 3);
                    
                    // Splitter (ðŸ’Ž)
                    if(player.skills.shrd) {
                        for(let k=0; k<5; k++) {
                            const ra = Math.random()*6.28;
                            state.entities.projectiles.push({x:en.x, y:en.y, vx:Math.cos(ra)*10, vy:Math.sin(ra)*10, l:30, dmg:10});
                        }
                    }

                    state.entities.gems.push({x: en.x, y: en.y, v: cfg.gemValue * (player.skills.gold ? 2 : 1
