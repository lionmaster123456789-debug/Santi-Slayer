<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer - God-Tier Edition</title>
    <style>
        /* CSS STYLING - DEFINIERT DIE VISUELLE OBERFL√ÑCHE */
        body { 
            margin: 0; 
            background: #000; 
            color: #fff; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            overflow: hidden; 
            user-select: none; 
        }
        canvas { 
            display: block; 
            background: #0a140a; 
        }
        #ui-overlay { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            pointer-events: none; 
            z-index: 100; 
        }
        #hud { 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            background: rgba(0,0,0,0.85); 
            padding: 25px; 
            border-radius: 15px; 
            border: 3px solid #f1c40f; 
            min-width: 320px; 
            box-shadow: 0 10px 40px #000; 
            backdrop-filter: blur(10px); 
        }
        .bar-container { 
            width: 100%; 
            height: 16px; 
            background: #222; 
            border-radius: 8px; 
            margin: 12px 0; 
            border: 1px solid #444; 
            overflow: hidden; 
        }
        #xp-bar { 
            height: 100%; 
            background: linear-gradient(90deg, #3498db, #00f2fe); 
            width: 0%; 
            transition: width 0.3s ease-out; 
        }
        #hp-bar { 
            height: 100%; 
            background: linear-gradient(90deg, #e74c3c, #ff4d4d); 
            width: 100%; 
        }
        #skill-slots { 
            display: flex; 
            gap: 10px; 
            margin-top: 15px; 
            flex-wrap: wrap; 
        }
        .slot { 
            width: 45px; 
            height: 45px; 
            border: 2px solid #f1c40f; 
            background: #111; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 22px; 
            border-radius: 8px; 
            position: relative; 
        }
        .lvl-tag { 
            position: absolute; 
            top: -5px; 
            right: -5px; 
            background: #27ae60; 
            font-size: 10px; 
            padding: 2px 5px; 
            border-radius: 4px; 
            border: 1px solid #fff; 
        }
        .btn-rhino { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            padding: 15px 35px; 
            background: #c0392b; 
            color: #fff; 
            text-decoration: none; 
            border-radius: 12px; 
            font-weight: bold; 
            border: 3px solid #fff; 
            pointer-events: all; 
            transition: 0.3s; 
            box-shadow: 0 10px 30px #000; 
        }
        .btn-rhino:hover { 
            background: #e74c3c; 
            transform: scale(1.1); 
        }
        .overlay { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.95); 
            display: none; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000; 
            pointer-events: all; 
            backdrop-filter: blur(15px); 
        }
        #upgrade-panel { 
            background: #1c2833; 
            padding: 50px; 
            border-radius: 30px; 
            border: 6px solid #f1c40f; 
            text-align: center; 
            width: 850px; 
            box-shadow: 0 0 100px #000; 
        }
        .card-container { 
            display: flex; 
            gap: 20px; 
            justify-content: center; 
            margin-top: 40px; 
        }
        .card { 
            background: #2c3e50; 
            padding: 25px; 
            border-radius: 20px; 
            cursor: pointer; 
            width: 240px; 
            border: 3px solid transparent; 
            transition: 0.3s; 
        }
        .card:hover { 
            border-color: #f1c40f; 
            background: #1abc9c; 
            transform: translateY(-15px); 
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div id="hud">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b style="font-size: 24px; color: #f1c40f; letter-spacing: 2px;">SANTI SLAYER</b>
                <span id="lvl-label" style="font-weight:bold; background:#f1c40f; color:#000; padding:2px 10px; border-radius:5px;">LV 1</span>
            </div>
            <div class="bar-container"><div id="xp-bar"></div></div>
            <div class="bar-container" style="background:#300;"><div id="hp-bar"></div></div>
            <div style="font-size: 13px; display:flex; justify-content:space-between;">
                <span>VITALIT√ÑT: <span id="hp-text">100 / 100</span></span>
                <span>KILLS: <span id="score-text">0</span></span>
            </div>
            <div id="skill-slots"></div>
        </div>
        <a href="https://rhinogamescom.wordpress.com" class="btn-rhino">GET BACK</a>
    </div>

    <div id="upgrade-overlay" class="overlay">
        <div id="upgrade-panel">
            <h1 style="color: #f1c40f; font-size: 42px; margin:0;">STUFENAUFSTIEG</h1>
            <p>W√§hle eine Gabe zur Vernichtung der Schlangen:</p>
            <div id="choice-container" class="card-container"></div>
        </div>
    </div>

    <script>
        /**
         * SANTI SLAYER - CORE ENGINE
         * VERSION: 2.5 (LONG FORM CODE)
         */

        // --- KONFIGURATION UND KONSTANTEN ---
        const CANVAS = document.getElementById('gameCanvas');
        const CTX = CANVAS.getContext('2d');
        const WORLD_SIZE = 8000;
        let CW, CH;

        // --- GLOBALER SPIELZUSTAND ---
        const game = {
            active: true,
            paused: false,
            tick: 0,
            startTime: Date.now(),
            lastSpawn: 0,
            score: 0
        };

        // --- SPIELER DATENSTRUKTUR ---
        const player = {
            x: WORLD_SIZE / 2,
            y: WORLD_SIZE / 2,
            hp: 100,
            maxHp: 100,
            speed: 5.5,
            xp: 0,
            nextXp: 100,
            lvl: 1,
            size: 35,
            angle: 0,
            lastFire: 0,
            frame: 0,
            skills: {},
            slots: [],
            poisonTick: 0,
            bunnyAngle: 0
        };

        // --- ENTITY MANAGEMENT ---
        const entities = {
            enemies: [],
            projectiles: [],
            gems: [],
            deco: [],
            fx: [],
            poisons: [],
            walls: []
        };

        // --- KAMERA SYSTEM ---
        const camera = {
            x: 0,
            y: 0,
            lerp: 0.1
        };

        // --- EINGABE SYSTEM ---
        const input = {
            w: false, a: false, s: false, d: false,
            ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false
        };

        // --- SKILL DATENBANK (20 ST√úCK) ---
        const SKILLS = [
            { id: 'fire', n: 'Schnellfeuer', i: 'üèπ', d: 'Erh√∂ht die Feuerrate massiv.' },
            { id: 'bolt', n: 'Kettenblitz', i: '‚ö°', d: 'Blitze springen zwischen Feinden.' },
            { id: 'bunny', n: 'Kampfhase', i: 'üêá', d: 'Ein rammender Hase besch√ºtzt dich.' },
            { id: 'spd', n: 'Fl√ºgelschuhe', i: 'üëü', d: 'Erh√∂ht dein Bewegungstempo.' },
            { id: 'reg', n: 'Regeneration', i: 'üçé', d: 'Heilt HP √ºber Zeit.' },
            { id: 'arm', n: 'R√ºstung', i: 'üõ°Ô∏è', d: 'Reduziert erlittenen Schaden.' },
            { id: 'aoe', n: 'Sprengkugel', i: 'üí£', d: 'Kugeln explodieren beim Aufprall.' },
            { id: 'mag', n: 'Magnetar', i: 'üß≤', d: 'Zieht Edelsteine magisch an.' },
            { id: 'vamp', n: 'Vampirbiss', i: 'üßõ', d: 'Heilung bei jedem Kill.' },
            { id: 'ice', n: 'Frosthauch', i: '‚ùÑÔ∏è', d: 'Verlangsamt nahe Gegner.' },
            { id: 'poi', n: 'Pestwolke', i: 'üß™', d: 'Hinterl√§sst Gift auf deinem Pfad.' },
            { id: 'crit', n: 'Fokus', i: 'üéØ', d: 'Chance auf Doppel-Schaden.' },
            { id: 'ring', n: 'Feuerring', i: 'üî•', d: 'Ein Ring aus Flammen umgibt dich.' },
            { id: 'gold', n: 'Gier', i: 'üí∞', d: 'Mehr XP pro Edelstein.' },
            { id: 'size', n: 'Titanenform', i: 'üêò', d: 'Mehr HP und physische Gr√∂√üe.' },
            { id: 'mult', n: 'Multischuss', i: '‚ú®', d: 'Feuert F√§chersch√ºsse ab.' },
            { id: 'dash', n: 'Schattensprung', i: 'üåÄ', d: 'Schneller Dash bei Richtungswechsel.' },
            { id: 'shrd', n: 'Splitterglas', i: 'üíé', d: 'Gegner splittern beim Tod.' },
            { id: 'wall', n: 'Erdmauer', i: 'üß±', d: 'Blockiert Gegner physisch.' },
            { id: 'luck', n: 'Gl√ºckspilz', i: 'üçÄ', d: 'Bessere Upgrades verf√ºgbar.' }
        ];

        // --- GEGNER DATENBANK (15 ST√úCK) ---
        const ENEMIES = [
            { n: 'Graswurm', c: '#2ecc71', h: 15, s: 2.2, t: 'snake' },
            { n: 'Waldnatter', c: '#27ae60', h:30, s: 2.5, t: 'snake' },
            { n: 'Steppenwolf', c: '#95a5a6', h: 50, s: 3.8, t: 'beast' },
            { n: 'Wespe', c: '#f1c40f', h: 20, s: 5.2, t: 'fly' },
            { n: 'H√∂hlenb√§r', c: '#5d4037', h: 180, s: 1.6, t: 'bear' },
            { n: 'Skorpion', c: '#d35400', h: 100, s: 3.0, t: 'insect' },
            { n: 'Wildsau', c: '#795548', h: 80, s: 4.2, t: 'beast' },
            { n: 'Golem', c: '#34495e', h: 800, s: 1.0, t: 'stone' },
            { n: 'Geist', c: '#fff', h: 100, s: 4.0, t: 'wraith' },
            { n: 'Oger', c: '#1b5e20', h: 400, s: 2.0, t: 'giant' },
            { n: 'D√§mon', c: '#c0392b', h: 500, s: 3.2, t: 'fire' },
            { n: 'Tentakel', c: '#8e44ad', h: 300, s: 2.6, t: 'void' },
            { n: 'Hydra', c: '#196f3d', h: 1500, s: 2.4, t: 'snake' },
            { n: 'W√§chter', c: '#d35400', h: 3000, s: 2.2, t: 'beast' },
            { n: 'SANTI-LORD', c: '#f00', h: 12000, s: 2.5, t: 'boss' }
        ];

        /**
         * INITIALISIERUNG
         */
        function start() {
            // Event Listener
            window.addEventListener('keydown', e => { if (e.key in input) input[e.key] = true; else if (e.key.toLowerCase() in input) input[e.key.toLowerCase()] = true; });
            window.addEventListener('keyup', e => { if (e.key in input) input[e.key] = false; else if (e.key.toLowerCase() in input) input[e.key.toLowerCase()] = false; });
            window.addEventListener('resize', resize);
            resize();

            // Welt Deko Generierung
            for (let i = 0; i < 200; i++) {
                entities.deco.push({
                    x: Math.random() * WORLD_SIZE,
                    y: Math.random() * WORLD_SIZE,
                    t: Math.random() > 0.5 ? 'tree' : 'rock',
                    sz: 40 + Math.random() * 60
                });
            }

            // Kamera Startposition
            camera.x = player.x;
            camera.y = player.y;

            updateUI();
            requestAnimationFrame(engine);
        }

        /**
         * ANPASSUNG DER CANVAS GR√ñSSE
         */
        function resize() {
            CW = CANVAS.width = window.innerWidth;
            CH = CANVAS.height = window.innerHeight;
        }

        /**
         * GEGNER SPAWN LOGIK
         */
        function spawn() {
            if (!game.active) return;
            const elapsed = (Date.now() - game.startTime) / 1000;
            const idx = Math.min(14, Math.floor(elapsed / 25));
            const base = ENEMIES[idx];

            const a = Math.random() * Math.PI * 2;
            const x = player.x + Math.cos(a) * 1100;
            const y = player.y + Math.sin(a) * 1100;

            entities.enemies.push({
                ...base,
                x, y,
                curHp: base.h + (player.lvl * 20),
                maxHp: base.h + (player.lvl * 20),
                spd: base.s + (idx * 0.1),
                sz: 25 + (idx * 3),
                segments: base.t === 'snake' ? Array(15).fill({ x, y }) : []
            });
        }
        setInterval(spawn, 900);

        /**
         * LEVEL UP & UPGRADE MEN√ú
         */
        function levelUp() {
            game.active = false;
            const overlay = document.getElementById('upgrade-overlay');
            const container = document.getElementById('choice-container');
            container.innerHTML = '';
            overlay.style.display = 'flex';

            // 3 Zuf√§llige Upgrades
            const pool = [...SKILLS].sort(() => 0.5 - Math.random()).slice(0, 3);
            
            pool.forEach(s => {
                const lv = player.skills[s.id] || 0;
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<div style="font-size:45px">${s.i}</div><b>${s.n}</b><p>${s.d}</p><br>Rang ${lv + 1}`;
                
                card.onclick = () => {
                    // Skill Logik hinzuf√ºgen
                    if (!player.skills[s.id]) {
                        if (player.slots.length < 8) {
                            player.slots.push(s);
                        } else {
                            // Keine Slots frei? Dann abbrechen au√üer es ist ein bestehender Skill
                            return;
                        }
                    }
                    player.skills[s.id] = lv + 1;

                    // Sofortige Effekte
                    if (s.id === 'reg') player.hp = Math.min(player.maxHp, player.hp + 40);
                    if (s.id === 'size') { player.maxHp += 20; player.hp += 20; player.size += 3; }

                    overlay.style.display = 'none';
                    game.active = true;
                    updateUI();
                    window.focus();
                };
                container.appendChild(card);
            });
        }

        /**
         * UI AKTUALISIERUNG
         */
        function updateUI() {
            document.getElementById('xp-bar').style.width = (player.xp / player.nextXp * 100) + '%';
            document.getElementById('hp-bar').style.width = (player.hp / player.maxHp * 100) + '%';
            document.getElementById('hp-text').innerText = `${Math.floor(player.hp)} / ${player.maxHp}`;
            document.getElementById('score-text').innerText = game.score;
            document.getElementById('lvl-label').innerText = `LV ${player.lvl}`;
            
            const slots = document.getElementById('skill-slots');
            slots.innerHTML = '';
            player.slots.forEach(s => {
                slots.innerHTML += `<div class="slot">${s.i}<div class="lvl-tag">${player.skills[s.id]}</div></div>`;
            });
        }

        /**
         * GRAFIK ENGINE - SPIELER RENDERN
         */
        function renderPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            
            // Detaillierter Umhang mit Wellenbewegung
            const wave = Math.sin(player.frame * 0.15) * 6;
            ctx.fillStyle = '#7b241c';
            ctx.beginPath();
            ctx.moveTo(-12, 0);
            ctx.quadraticCurveTo(-35, 25 + wave, -55, 5 + wave);
            ctx.quadraticCurveTo(-40, 0, -55, -5 - wave);
            ctx.quadraticCurveTo(-35, -25 - wave, -12, 0);
            ctx.fill();

            ctx.rotate(player.angle);

            // K√∂rper
            ctx.fillStyle = '#2471a3';
            ctx.beginPath(); ctx.arc(0, 0, player.size, 0, 6.28); ctx.fill();
            ctx.strokeStyle = '#1b4f72'; ctx.lineWidth = 4; ctx.stroke();

            // Helm
            ctx.fillStyle = '#5d6d7e';
            ctx.beginPath(); ctx.arc(0, 0, player.size * 0.9, 3.14, 6.28); ctx.fill();
            
            // Leuchtendes Visier
            ctx.fillStyle = '#f1c40f';
            ctx.shadowBlur = 15; ctx.shadowColor = '#f1c40f';
            ctx.fillRect(-16, -6, 32, 6);
            ctx.shadowBlur = 0;

            ctx.restore();
        }

        /**
         * GRAFIK ENGINE - GEGNER RENDERN
         */
        function renderEnemy(en) {
            ctx.save();
            ctx.fillStyle = en.c;
            
            if (en.t === 'snake') {
                en.segments.forEach((seg, i) => {
                    const r = en.sz * (1 - i / 20);
                    ctx.beginPath(); ctx.arc(seg.x, seg.y, r, 0, 6.28); ctx.fill();
                });
            } else {
                ctx.beginPath(); ctx.arc(en.x, en.y, en.sz, 0, 6.28); ctx.fill();
                // Details: Augen
                ctx.fillStyle = '#000';
                ctx.beginPath(); ctx.arc(en.x - 10, en.y - 5, 4, 0, 6.28); ctx.fill();
                ctx.beginPath(); ctx.arc(en.x + 10, en.y - 5, 4, 0, 6.28); ctx.fill();
            }

            // Lebensbalken
            ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(en.x - 30, en.y - en.sz - 25, 60, 8);
            ctx.fillStyle = '#e74c3c'; ctx.fillRect(en.x - 30, en.y - en.sz - 25, 60 * (en.curHp / en.maxHp), 8);
            ctx.restore();
        }

        /**
         * CORE ENGINE - UPDATE LOOP
         */
        function update() {
            if (!game.active) return;

            // Bewegung
            let mx = 0, my = 0;
            if (input.w || input.ArrowUp) my -= 1;
            if (input.s || input.ArrowDown) my += 1;
            if (input.a || input.ArrowLeft) mx -= 1;
            if (input.d || input.ArrowRight) mx += 1;

            if (mx !== 0 || my !== 0) {
                const mag = Math.hypot(mx, my);
                const s = player.speed + (player.skills.spd || 0) * 0.8;
                player.x += (mx / mag) * s;
                player.y += (my / mag) * s;
                player.angle = Math.atan2(my, mx);
                player.frame++;
            }

            // World Clamp
            player.x = Math.max(50, Math.min(WORLD_SIZE - 50, player.x));
            player.y = Math.max(50, Math.min(WORLD_SIZE - 50, player.y));

            // Kamera Lerp
            camera.x += (player.x - camera.x) * camera.lerp;
            camera.y += (player.y - camera.y) * camera.lerp;

            // Skill: Blitz (Kettenblitz-Handler)
            if (player.skills.bolt && Math.random() < 0.02 * player.skills.bolt) {
                const nearby = entities.enemies.filter(e => Math.hypot(e.x - player.x, e.y - player.y) < 600);
                if (nearby.length > 0) {
                    const target = nearby[Math.floor(Math.random() * nearby.length)];
                    target.curHp -= 50;
                    entities.fx.push({ t: 'bolt', x1: player.x, y1: player.y, x2: target.x, y2: target.y, l: 15 });
                }
            }

            // Skill: Gift (Pestwolke)
            if (player.skills.poi) {
                player.poisonTick++;
                if (player.poisonTick > 80) {
                    entities.poisons.push({ x: player.x, y: player.y, r: 80 + player.skills.poi * 20, l: 300 });
                    player.poisonTick = 0;
                }
            }

            // Schie√üen (Automatischer Kampf)
            const cd = 700 / (player.skills.fire || 1);
            if (Date.now() - player.lastFire > cd) {
                const targets = entities.enemies.filter(en => Math.hypot(en.x - player.x, en.y - player.y) < 700);
                if (targets.length > 0) {
                    const target = targets[0];
                    const a = Math.atan2(target.y - player.y, target.x - player.x);
                    const count = player.skills.mult ? 1 + Math.floor(player.skills.mult / 1.5) : 1;
                    for (let i = 0; i < count; i++) {
                        const spread = (i - (count - 1) / 2) * 0.2;
                        entities.projectiles.push({
                            x: player.x, y: player.y,
                            vx: Math.cos(a + spread) * 15,
                            vy: Math.sin(a + spread) * 15,
                            l: 100, dmg: 10 + (player.skills.aoe ? 10 : 0)
                        });
                    }
                    player.lastFire = Date.now();
                }
            }

            // --- ENTITY UPDATES ---
            
            // Projektile fliegen lassen
            for (let i = entities.projectiles.length - 1; i >= 0; i--) {
                const p = entities.projectiles[i];
                p.x += p.vx; p.y += p.vy; p.l--;
                
                // Kollision mit Gegnern
                for (let j = 0; j < entities.enemies.length; j++) {
                    const en = entities.enemies[j];
                    if (Math.hypot(p.x - en.x, p.y - en.y) < en.sz + 15) {
                        const crit = player.skills.crit && Math.random() < 0.2;
                        en.curHp -= p.dmg * (crit ? 2.5 : 1);
                        p.l = 0; // Projektil zerst√∂ren
                        break;
                    }
                }
                if (p.l <= 0) entities.projectiles.splice(i, 1);
            }

            // Gegner bewegen und Schlangen-Segmente
            for (let i = entities.enemies.length - 1; i >= 0; i--) {
                const en = entities.enemies[i];
                const a = Math.atan2(player.y - en.y, player.x - en.x);
                en.x += Math.cos(a) * en.spd;
                en.y += Math.sin(a) * en.spd;

                if (en.t === 'snake') {
                    en.segments.unshift({ x: en.x, y: en.y });
                    en.segments.pop();
                }

                // Schaden am Spieler
                if (Math.hypot(player.x - en.x, player.y - en.y) < player.size + en.sz) {
                    player.hp -= (0.5 / (player.skills.arm || 1));
                }

                // Tod des Gegners
                if (en.curHp <= 0) {
                    // Skill: Vampir
                    if (player.skills.vamp && Math.random() < 0.1) player.hp = Math.min(player.maxHp, player.hp + 2);
                    
                    // Drop Gem
                    entities.gems.push({ x: en.x, y: en.y, v: 25 * (player.skills.gold ? 1.8 : 1) });
                    
                    entities.enemies.splice(i, 1);
                    game.score++;
                    updateUI();
                }
            }

            // Edelsteine einsammeln (Magnetar)
            for (let i = entities.gems.length - 1; i >= 0; i--) {
                const g = entities.gems[i];
                const d = Math.hypot(player.x - g.x, player.y - g.y);
                const magnetRange = 150 + (player.skills.mag || 0) * 80;
                if (d < magnetRange) {
                    g.x += (player.x - g.x) * 0.2;
                    g.y += (player.y - g.y) * 0.2;
                    if (d < 25) {
                        player.xp += g.v;
                        entities.gems.splice(i, 1);
                        if (player.xp >= player.nextXp) {
                            player.xp = 0;
                            player.lvl++;
                            player.nextXp *= 1.3;
                            levelUp();
                        }
                        updateUI();
                    }
                }
            }

            // Timer & Effekt-Abbau
            entities.fx.forEach((ef, i) => { ef.l--; if (ef.l < 0) entities.fx.splice(i, 1); });
            entities.poisons.forEach((ps, i) => { ps.l--; if (ps.l < 0) entities.poisons.splice(i, 1); });

            // Tod Check
            if (player.hp <= 0) location.reload();
        }

        /**
         * CORE ENGINE - RENDERING LOOP
         */
        function engine() {
            update();

            ctx.clearRect(0, 0, CW, CH);
            ctx.save();
            ctx.translate(CW / 2 - camera.x, CH / 2 - camera.y);

            // Gitter Zeichnen (Map Orientierung)
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.lineWidth = 2;
            for (let x = 0; x <= WORLD_SIZE; x += 300) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, WORLD_SIZE); ctx.stroke();
            }
            for (let y = 0; y <= WORLD_SIZE; y += 300) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(WORLD_SIZE, y); ctx.stroke();
            }

            // World Border
            ctx.strokeStyle = '#c0392b';
            ctx.lineWidth = 15;
            ctx.strokeRect(0, 0, WORLD_SIZE, WORLD_SIZE);

            // Deko Objekte (B√§ume etc.)
            entities.deco.forEach(d => {
                ctx.fillStyle = d.t === 'tree' ? '#145a32' : '#566573';
                ctx.beginPath(); ctx.arc(d.x, d.y, d.sz, 0, 6.28); ctx.fill();
            });

            // Giftwolken
            ctx.globalAlpha = 0.3;
            ctx.fillStyle = '#8e44ad';
            entities.poisons.forEach(p => {
