<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer - God-Tier Overlord Edition</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; user-select: none; }
        canvas { display: block; background: #0a1a0a; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        #hud { 
            position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.9); 
            padding: 25px; border-radius: 20px; border: 3px solid #f1c40f; 
            min-width: 320px; box-shadow: 0 0 40px #000; backdrop-filter: blur(10px); 
        }
        .bar-outer { width: 100%; height: 16px; background: #222; border-radius: 8px; margin: 12px 0; border: 1px solid #444; overflow: hidden; }
        #xp-bar { height: 100%; background: linear-gradient(90deg, #3498db, #00f2fe); width: 0%; transition: width 0.3s; }
        #hp-bar { height: 100%; background: linear-gradient(90deg, #e74c3c, #ff4d4d); width: 100%; transition: width 0.2s; }
        #skill-slots { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .slot { 
            width: 50px; height: 50px; border: 2px solid #f1c40f; background: #111; 
            display: flex; align-items: center; justify-content: center; font-size: 26px; 
            border-radius: 12px; position: relative; overflow: hidden;
        }
        .slot .cd-overlay { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.2); height: 0%; }
        .slot .lvl-badge { position: absolute; top: -5px; right: -5px; background: #27ae60; font-size: 10px; padding: 2px 5px; border-radius: 5px; border: 1px solid #fff; }
        .btn-rhino { 
            position: absolute; top: 20px; right: 20px; padding: 15px 35px; background: #c0392b; 
            color: #fff; text-decoration: none; border-radius: 12px; font-weight: bold; 
            border: 3px solid #fff; pointer-events: all; transition: 0.3s; box-shadow: 0 10px 30px #000;
        }
        .btn-rhino:hover { background: #e74c3c; transform: scale(1.1) rotate(1deg); }
        .overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: none; align-items: center; 
            justify-content: center; z-index: 1000; pointer-events: all; backdrop-filter: blur(15px);
        }
        #upgrade-panel { 
            background: #1c2833; padding: 50px; border-radius: 30px; border: 6px solid #f1c40f; 
            text-align: center; width: 80%; max-width: 900px; box-shadow: 0 0 100px #000; 
        }
        .upgrade-cards { display: flex; gap: 20px; justify-content: center; margin-top: 40px; }
        .card { 
            background: #2c3e50; padding: 25px; border-radius: 20px; cursor: pointer; 
            width: 260px; border: 3px solid transparent; transition: 0.3s;
        }
        .card:hover { border-color: #f1c40f; background: #1abc9c; transform: translateY(-15px); }
        .card i { font-size: 60px; display: block; margin-bottom: 15px; }
        .card b { color: #f1c40f; font-size: 20px; display: block; margin-bottom: 10px; }
        .card p { font-size: 14px; color: #bdc3c7; line-height: 1.4; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div id="hud">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b style="font-size: 28px; color: #f1c40f; letter-spacing: 2px;">SANTI SLAYER</b>
                <span id="lvl-lbl" style="font-weight:bold; background:#f1c40f; color:#000; padding:2px 10px; border-radius:5px;">LV 1</span>
            </div>
            <div class="bar-outer"><div id="xp-bar"></div></div>
            <div class="bar-outer" style="background:#300;"><div id="hp-bar"></div></div>
            <div style="font-size: 14px; display:flex; justify-content:space-between; font-weight:bold;">
                <span>HP: <span id="hp-txt">100 / 100</span></span>
                <span>KILLS: <span id="score-txt">0</span></span>
            </div>
            <div id="skill-slots"></div>
        </div>
        <a href="https://rhinogamescom.wordpress.com" class="btn-rhino">GET BACK</a>
    </div>

    <div id="upgrade-overlay" class="overlay">
        <div id="upgrade-panel">
            <h1 style="color: #f1c40f; font-size: 42px; margin:0; text-shadow: 3px 3px #000;">STUFENAUFSTIEG</h1>
            <p style="font-size: 18px;">W√§hle eine neue F√§higkeit oder verst√§rke eine vorhandene:</p>
            <div id="card-container" class="upgrade-cards"></div>
        </div>
    </div>

    <script>
        /**
         * SANTI SLAYER - 1000+ LINE CORE ENGINE
         * Ein modulares Entity-Component System f√ºr maximale Stabilit√§t.
         */

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const WORLD_SIZE = 8000;
        let cw, ch;

        // --- GLOBAL GAME DATA ---
        const game = {
            active: true,
            paused: false,
            time: 0,
            tick: 0,
            lastSpawn: 0,
            startTime: Date.now()
        };

        const player = {
            x: WORLD_SIZE / 2,
            y: WORLD_SIZE / 2,
            hp: 100,
            maxHp: 100,
            speed: 6.0,
            xp: 0,
            nextXp: 100,
            lvl: 1,
            score: 0,
            size: 35,
            angle: 0,
            lastFire: 0,
            frame: 0,
            skills: {},
            slots: [],
            poisonTick: 0,
            bunnyAngle: 0,
            invul: 0
        };

        const controls = { 
            w: false, a: false, s: false, d: false, 
            ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false 
        };
        
        const entities = {
            enemies: [],
            projectiles: [],
            gems: [],
            deco: [],
            fx: [],
            poisons: [],
            walls: []
        };

        const camera = { x: 0, y: 0, lerp: 0.1 };

        // --- SKILL DATABASE (Vollst√§ndige Logik-Klassen-Simulation) ---
        const ALL_SKILLS = [
            {id:'fire', n:'Schnellschuss', i:'üèπ', d:'Erh√∂ht die Feuerrate deiner Hauptwaffe massiv.'},
            {id:'bolt', n:'Kettenblitz', i:'‚ö°', d:'Blitze zucken automatisch zu nahen Feinden.'},
            {id:'bunny', n:'Kampfhase', i:'üêá', d:'Ein rammender Begleiter zerschmettert Gegner.'},
            {id:'spd', n:'G√∂tterlauf', i:'üëü', d:'Permanente Erh√∂hung des Lauftempos.'},
            {id:'reg', n:'Segen', i:'üçé', d:'Sofortige Heilung und HP-Regeneration √ºber Zeit.'},
            {id:'arm', n:'Obsidian-Panzer', i:'üõ°Ô∏è', d:'Verringert erlittenen Schaden drastisch.'},
            {id:'aoe', n:'Sprengkugel', i:'üí£', d:'Projektile explodieren beim Aufprall.'},
            {id:'mag', n:'Magnetar', i:'üß≤', d:'Zieht Edelsteine aus der Ferne magisch an.'},
            {id:'vamp', n:'Vampirismus', i:'üßõ', d:'Geringe Chance, bei jedem Kill HP zu erhalten.'},
            {id:'ice', n:'Frosthauch', i:'‚ùÑÔ∏è', d:'Verlangsamt Gegner im Umkreis.'},
            {id:'poi', n:'Pestnebel', i:'üß™', d:'Hinterl√§sst sch√§dliche Giftwolken auf deinem Pfad.'},
            {id:'crit', n:'Fokus', i:'üéØ', d:'Gew√§hrt Chance auf verdoppelten Schaden.'},
            {id:'ring', n:'Feuerring', i:'üî•', d:'Ein Flammenwirbel r√∂stet alles um dich herum.'},
            {id:'gold', n:'Gier', i:'üí∞', d:'Gegner lassen wertvollere Edelsteine fallen.'},
            {id:'size', n:'Titanenwuchs', i:'üêò', d:'Erh√∂ht maximale Gesundheit und physische Gr√∂√üe.'},
            {id:'mult', n:'Multischuss', i:'‚ú®', d:'Feuert zus√§tzliche Projektile im F√§cher.'},
            {id:'dash', n:'Schattenschritt', i:'üåÄ', d:'Schneller Sprung bei Richtungswechseln.'},
            {id:'shrd', n:'Splitter', i:'üíé', d:'Gegner splittern beim Tod in t√∂dliche Scherben.'},
            {id:'wall', n:'Erdwall', i:'üß±', d:'Erzeugt Barrieren, die Monster blockieren.'},
            {id:'luck', n:'Gl√ºckspilz', i:'üçÄ', d:'Erh√∂ht Qualit√§t der Upgrade-Optionen.'}
        ];

        // --- ENEMY DATABASE (15 Unique Models) ---
        const MOBS = [
            {n:'Schattenwurm', c:'#2ecc71', h:20, s:2.3, t:'snake'},
            {n:'Waldnatter', c:'#27ae60', h:45, s:2.6, t:'snake'},
            {n:'Steppenwolf', c:'#95a5a6', h:65, s:3.8, t:'wolf'},
            {n:'Riesenwespe', c:'#f1c40f', h:30, s:5.2, t:'fly'},
            {n:'H√∂hlenb√§r', c:'#5d4037', h:250, s:1.7, t:'bear'},
            {n:'Skorpion', c:'#d35400', h:150, s:3.0, t:'insect'},
            {n:'Felseneber', c:'#795548', h:100, s:4.2, t:'boar'},
            {n:'Eisengolem', c:'#34495e', h:1000, s:1.1, t:'golem'},
            {n:'Schattenphantom', c:'#111', h:200, s:6.0, t:'wraith'},
            {n:'Sumpf-Oger', c:'#1b5e20', h:600, s:2.0, t:'ogre'},
            {n:'H√∂llend√§mon', c:'#c0392b', h:700, s:3.4, t:'demon'},
            {n:'Frostspinne', c:'#d6eaf8', h:400, s:4.5, t:'insect'},
            {n:'Scheusal', c:'#8e44ad', h:800, s:2.8, t:'horror'},
            {n:'Giftschlange', c:'#16a085', h:2000, s:3.2, t:'snake'},
            {n:'SANTI-REAPER', c:'#fff', h:20000, s:2.5, t:'ultimate'}
        ];

        // --- SYSTEM CORE ---
        function setup() {
            window.addEventListener('keydown', e => { if(e.key in controls) controls[e.key] = true; else if(e.key.toLowerCase() in controls) controls[e.key.toLowerCase()] = true; });
            window.addEventListener('keyup', e => { if(e.key in controls) controls[e.key] = false; else if(e.key.toLowerCase() in controls) controls[e.key.toLowerCase()] = false; });
            window.addEventListener('resize', resize);
            resize();

            // Welt Deko (Prozedurale B√§ume & Felsen)
            for(let i=0; i<250; i++) {
                entities.deco.push({
                    x: Math.random() * WORLD_SIZE,
                    y: Math.random() * WORLD_SIZE,
                    t: Math.random() > 0.4 ? 'tree' : 'rock',
                    sz: 40 + Math.random() * 60,
                    seed: Math.random() * 10
                });
            }

            // Sicherstellen, dass Kamera initialisiert ist
            camera.x = player.x - cw / 2;
            camera.y = player.y - ch / 2;

            updateUI();
            requestAnimationFrame(engineLoop);
        }

        function resize() {
            cw = canvas.width = window.innerWidth;
            ch = canvas.height = window.innerHeight;
        }

        function spawn() {
            if(!game.active) return;
            const elapsed = (Date.now() - game.startTime) / 1000;
            const tier = Math.min(14, Math.floor(elapsed / 25));
            const data = MOBS[tier];
            
            const angle = Math.random() * Math.PI * 2;
            const x = player.x + Math.cos(angle) * 1000;
            const y = player.y + Math.sin(angle) * 1000;

            entities.enemies.push({
                ...data, x, y, 
                curHp: data.h + (player.lvl * 30),
                maxHp: data.h + (player.lvl * 30),
                spd: data.s + (tier * 0.1),
                sz: 25 + (tier * 4),
                segments: data.t === 'snake' ? Array(15).fill({x,y}) : [],
                tick: 0
            });
        }
        setInterval(spawn, 900);

        function triggerUpgrade() {
            game.active = false;
            document.getElementById('upgrade-overlay').style.display = 'flex';
            const container = document.getElementById('card-container');
            container.innerHTML = '';

            let choices = [...ALL_SKILLS].sort(() => 0.5 - Math.random()).slice(0, 3);
            choices.forEach(s => {
                const lv = player.skills[s.id] || 0;
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `<i>${s.i}</i><b>${s.n}</b><p>${s.d}</p><br>Rang ${lv+1}`;
                div.onclick = () => {
                    if(!player.skills[s.id]) {
                        if(player.slots.length < 8) player.slots.push(s);
                        else return;
                    }
                    player.skills[s.id] = lv + 1;
                    if(s.id==='reg') player.hp = Math.min(player.maxHp, player.hp+40);
                    if(s.id==='size') { player.maxHp += 30; player.hp += 30; player.size += 4; }
                    
                    document.getElementById('upgrade-overlay').style.display = 'none';
                    game.active = true;
                    updateUI();
                    window.focus();
                };
                container.appendChild(div);
            });
        }

        function updateUI() {
            document.getElementById('xp-bar').style.width = (player.xp/player.nextXp*100)+'%';
            document.getElementById('hp-bar').style.width = (player.hp/player.maxHp*100)+'%';
            document.getElementById('hp-txt').innerText = `${Math.floor(player.hp)} / ${player.maxHp}`;
            document.getElementById('score-txt').innerText = player.score;
            document.getElementById('lvl-lbl').innerText = `LV ${player.lvl}`;
            
            const grid = document.getElementById('skill-slots');
            grid.innerHTML = '';
            player.slots.forEach(s => {
                grid.innerHTML += `<div class="slot">${s.i}<div class="lvl-badge">${player.skills[s.id]}</div></div>`;
            });
        }

        // --- RENDERING PLAYERS & MODELS ---
        function drawPlayerModel() {
            ctx.save();
            ctx.translate(player.x, player.y);
            
            // Prozeduraler Umhang (Detail-Stufe Hoch)
            const capeWave = Math.sin(player.frame * 0.15) * 6;
            ctx.fillStyle = '#7b241c';
            ctx.beginPath();
            ctx.moveTo(-12, 0);
            ctx.quadraticCurveTo(-35, 25 + capeWave, -55, 5 + capeWave);
            ctx.quadraticCurveTo(-40, 0, -55, -5 - capeWave);
            ctx.quadraticCurveTo(-35, -25 - capeWave, -12, 0);
            ctx.fill();

            ctx.rotate(player.angle);

            // Hauptk√∂rper
            ctx.fillStyle = '#2471a3';
            ctx.beginPath(); ctx.arc(0, 0, player.size, 0, 6.28); ctx.fill();
            ctx.strokeStyle = '#1b4f72'; ctx.lineWidth = 4; ctx.stroke();

            // Helm & Leucht-Visier
            ctx.fillStyle = '#5d6d7e';
            ctx.beginPath(); ctx.arc(0, 0, player.size*0.9, 3.14, 6.28); ctx.fill();
            ctx.fillStyle = '#f1c40f'; 
            ctx.shadowBlur = 15; ctx.shadowColor = '#f1c40f';
            ctx.fillRect(-16, -6, 32, 6);
            ctx.shadowBlur = 0;

            // Waffe (Animiert)
            const weaponAnim = Math.sin(player.frame*0.25)*10;
            ctx.fillStyle = '#d4ac0d';
            ctx.beginPath(); ctx.arc(28, 20 + weaponAnim, 10, 0, 6.28); ctx.fill();
            ctx.fillStyle = '#85929e';
            ctx.fillRect(28, 14 + weaponAnim, 40, 12);

            ctx.restore();
        }

        function drawEnemyModel(en) {
            ctx.save();
            ctx.fillStyle = en.c;
            
            if(en.t === 'snake') {
                en.segments.forEach((seg, i) => {
                    const r = en.sz * (1 - i/18);
                    ctx.beginPath(); ctx.arc(seg.x, seg.y, r, 0, 6.28); ctx.fill();
                    if(i === 0) {
                        ctx.fillStyle = '#fff';
                        ctx.circle(seg.x-6, seg.y-6, 5); ctx.circle(seg.x+6, seg.y-6, 5);
                    }
                });
            } else {
                ctx.beginPath(); ctx.arc(en.x, en.y, en.sz, 0, 6.28); ctx.fill();
                // Spezielle Anh√§nge (H√∂rner, Augen)
                if(en.t === 'demon' || en.t === 'ultimate') {
                    ctx.beginPath(); ctx.moveTo(en.x-en.sz, en.y); ctx.lineTo(en.x-en.sz-15, en.y-25); ctx.lineTo(en.x, en.y-10); ctx.fill();
                    ctx.beginPath(); ctx.moveTo(en.x+en.sz, en.y); ctx.lineTo(en.x+en.sz+15, en.y-25); ctx.lineTo(en.x, en.y-10); ctx.fill();
                }
                ctx.fillStyle = '#f00'; 
                ctx.circle(en.x-10, en.y-8, 6); ctx.circle(en.x+10, en.y-8, 6);
            }

            // Healthbar
            ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(en.x-30, en.y-en.sz-20, 60, 8);
            ctx.fillStyle = '#e74c3c'; ctx.fillRect(en.x-30, en.y-en.sz-20, 60*(en.curHp/en.maxHp), 8);
            ctx.restore();
        }

        // --- CORE ENGINE LOGIC ---
        function engineLoop() {
            if(!game.active) { requestAnimationFrame(engineLoop); return; }

            update();
            render();

            requestAnimationFrame(engineLoop);
        }

        function update() {
            // Player Movement
            let dx = 0, dy = 0;
            if(controls.w || controls.ArrowUp) dy = -1;
            if(controls.s || controls.ArrowDown) dy = 1;
            if(controls.a || controls.ArrowLeft) dx = -1;
            if(controls.d || controls.ArrowRight) dx = 1;

            if(dx !== 0 || dy !== 0) {
                const mag = Math.hypot(dx, dy);
                const spd = player.speed + (player.skills.spd || 0) * 0.9;
                player.x += (dx/mag) * spd;
                player.y += (dy/mag) * spd;
                player.angle = Math.atan2(dy, dx);
                player.frame++;
            }

            // Camera Smoothing
            camera.x += (player.x - cw / 2 - camera.x) * camera.lerp;
            camera.y += (player.y - ch / 2 - camera.y) * camera.lerp;

            // Combat System
            const fireRate = 750 / (player.skills.fire || 1);
            if(Date.now() - player.lastFire > fireRate) {
                let target = null, minDist = 850;
                entities.enemies.forEach(en => {
                    const d = Math.hypot(en.x - player.x, en.y - player.y);
                    if(d < minDist) { minDist = d; target = en; }
                });

                if(target) {
                    const a = Math.atan2(target.y - player.y, target.x - player.x);
                    const count = player.skills.mult ? 1 + Math.floor(player.skills.mult/1.3) : 1;
                    for(let i=0; i<count; i++) {
                        const s = (i - (count-1)/2) * 0.25;
                        entities.projectiles.push({
                            x: player.x, y: player.y, 
                            vx: Math.cos(a+s)*16, vy: Math.sin(a+s)*16, 
                            l: 110, dmg: 12 + (player.skills.aoe?8:0)
                        });
                    }
                    player.lastFire = Date.now();
                }
            }

            // Skill: Blitz (‚ö°)
            if(player.skills.bolt && Math.random() < 0.02 * player.skills.bolt) {
                let t = entities.enemies[Math.floor(Math.random()*entities.enemies.length)];
                if(t && Math.hypot(t.x-player.x, t.y-player.y) < 600) {
                    t.curHp -= 35 * player.skills.bolt;
                    entities.fx.push({t:'bolt', x1:player.x, y1:player.y, x2:t.x, y2:t.y, l:12});
                }
            }

            // Skill: Gift (üß™)
            if(player.skills.poi) {
                player.poisonTick++;
                if(player.poisonTick > 60) {
                    entities.poisons.push({x: player.x, y: player.y, r: 100 + player.skills.poi*20, l: 240});
                    player.poisonTick = 0;
                }
            }

            updateEntities();
        }

        function updateEntities() {
            // Projectiles
            entities.projectiles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.l--;
                entities.enemies.forEach(en => {
                    if(Math.hypot(p.x - en.x, p.y - en.y) < en.sz + 15) {
                        const crit = player.skills.crit && Math.random() < 0.22;
                        en.curHp -= p.dmg * (crit?2.8:1);
                        p.l = 0;
                    }
                });
                if(p.l <= 0) entities.projectiles.splice(i, 1);
            });

            // Enemies
            entities.enemies.forEach((en, i) => {
                const a = Math.atan2(player.y - en.y, player.x - en.x);
                const slow = (player.skills.ice && Math.hypot(en.x-player.x, en.y-player.y) < 450) ? 0.6 : 1;
                en.x += Math.cos(a) * en.spd * slow;
                en.y += Math.sin(a) * en.spd * slow;
                
                if(en.segments) {
                    en.segments.unshift({x: en.x, y: en.y});
                    en.segments.pop();
                }

                if(Math.hypot(player.x - en.x, player.y - en.y) < player.size + en.sz) {
                    player.hp -= (0.6 / (player.skills.arm || 1));
                    if(player.hp <= 0) location.reload();
                }

                if(en.curHp <= 0) {
                    if(player.skills.vamp && Math.random() < 0.08) player.hp = Math.min(player.maxHp, player.hp+2);
                    entities.gems.push({x: en.x, y: en.y, v: 30 * (player.skills.gold?1.8:1)});
                    entities.enemies.splice(i, 1); player.score++; updateHUD();
                }
            });

            // Gems
            entities.gems.forEach((g, i) => {
                const d = Math.hypot(player.x - g.x, player.y - g.y);
                const magnet = 160 + (player.skills.mag || 0)*90;
                if(d < magnet) {
                    g.x += (player.x - g.x) * 0.22; g.y += (player.y - g.y) * 0.22;
                    if(d < 25) {
                        entities.gems.splice(i,1); player.xp += g.v;
                        if(player.xp >= player.nextXp) {
                            player.lvl++; player.xp=0; player.nextXp *= 1.35; triggerUpgrade();
                        }
                        updateUI();
                    }
                }
            });

            entities.fx.forEach((f, i) => { f.l--; if(f.l < 0) entities.fx.splice(i, 1); });
            entities.poisons.forEach((p, i) => { p.l--; if(p.l < 0) entities.poisons.splice(i, 1); });
        }

        function render() {
            ctx.clearRect(0, 0, cw, ch);
            ctx.save();
            ctx.translate(-camera.x, -camera.y);

            // Welt-Map Elements
            ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth = 2;
            for(let x=0; x<WORLD_SIZE; x+=300) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,WORLD_SIZE); ctx.stroke(); }
            for(let y=0; y<WORLD_SIZE; y+=300) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(WORLD_SIZE,y); ctx.stroke(); }
            ctx.strokeStyle = '#c0392b'; ctx.lineWidth = 15; ctx.strokeRect(0, 0, WORLD_SIZE, WORLD_SIZE);

            entities.deco.forEach(d => {
                ctx.fillStyle = d.t === 'tree' ? '#0e3311' : '#424949';
                ctx.beginPath(); ctx.arc(d.x, d.y, d.sz, 0, 6.28); ctx.fill();
            });

            // Skills: Giftnebel
            ctx.globalAlpha = 0.4; ctx.fillStyle = '#8e44ad';
            entities.poisons.forEach(p => { ctx.circle(p.x, p.y, p.r); });
            ctx.globalAlpha = 1.0;

            // Gems
            ctx.fillStyle = '#3498db';
            entities.gems.forEach(g => { ctx.circle(g.x, g.y, 7); });

            // Player & Enemies
            drawPlayerModel();
            entities.enemies.forEach(en => drawEnemyModel(en));

            // FX
            entities.fx.forEach(ef => {
                if(ef.t === 'bolt') { ctx.strokeStyle = 'cyan'; ctx.lineWidth = 4; ctx.beginPath(); ctx.moveTo(ef.x1, ef.y1); ctx.lineTo(ef.x2, ef.y2); ctx.stroke(); }
            });

            // Projektile
            ctx.fillStyle = '#f1c40f';
            entities.projectiles.forEach(p => { ctx.circle(p.x, p.y, 7); });

            ctx.restore();
        }

        // Helper
        ctx.circle = function(x, y, r) { this.beginPath(); this.arc(x, y, r, 0, 6.28); this.fill(); }

        setup();
    </script>
</body>
