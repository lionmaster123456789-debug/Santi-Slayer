<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer - Legend Edition</title>
    <style>
        body { margin: 0; background: #0c0c0c; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        canvas { display: block; background: #1e392a; cursor: crosshair; }
        
        /* UI Styling */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #stats-panel { 
            position: absolute; top: 20px; left: 20px; 
            background: rgba(0,0,0,0.85); padding: 20px; border-radius: 15px; 
            border: 2px solid #f1c40f; min-width: 260px; box-shadow: 0 0 15px rgba(0,0,0,0.5); 
        }
        .xp-bar-outer { width: 100%; height: 14px; background: #333; border-radius: 7px; margin: 10px 0; border: 1px solid #555; overflow: hidden; }
        #xp-bar-inner { height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71); width: 0%; transition: width 0.3s; }
        
        #slots-display { display: flex; gap: 6px; margin-top: 15px; flex-wrap: wrap; }
        .skill-slot { 
            width: 40px; height: 40px; border: 2px solid #f1c40f; background: #1a1a1a; 
            display: flex; align-items: center; justify-content: center; font-size: 20px; 
            border-radius: 8px; position: relative; 
        }
        .skill-slot span { position: absolute; bottom: -2px; right: 2px; font-size: 10px; color: #0f0; font-weight: bold; }
        
        /* Get Back Button */
        .btn-back { 
            position: absolute; top: 20px; right: 20px; pointer-events: all;
            padding: 12px 25px; background: #c0392b; color: white; text-decoration: none; 
            border-radius: 10px; font-weight: bold; border: 3px solid #fff; transition: 0.2s; 
        }
        .btn-back:hover { background: #e74c3c; transform: scale(1.05); }

        /* Upgrade Menu */
        #upgrade-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; 
            z-index: 5000; pointer-events: all;
        }
        #upgrade-box { 
            background: #2c3e50; padding: 40px; border-radius: 20px; border: 5px solid #f1c40f; 
            text-align: center; width: 700px; box-shadow: 0 0 50px #000;
        }
        .card-row { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
        .upgrade-card { 
            background: #34495e; padding: 25px; border-radius: 15px; cursor: pointer; 
            width: 180px; border: 2px solid transparent; transition: 0.3s;
        }
        .upgrade-card:hover { background: #1abc9c; border-color: #fff; transform: translateY(-10px); }
        .upgrade-card i { font-size: 50px; display: block; margin-bottom: 15px; }
        
        #hp-display { font-size: 18px; font-weight: bold; color: #e74c3c; margin-top: 5px; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div id="stats-panel">
            <div style="font-size: 24px; color: #f1c40f; font-weight: bold;">SANTI SLAYER</div>
            <div class="xp-bar-outer"><div id="xp-bar-inner"></div></div>
            <div id="hp-display">HP: <span id="hp-cur">100</span> / <span id="hp-max">100</span></div>
            <div style="font-size: 14px; margin-top: 5px;">Level: <span id="lbl-lvl">1</span> | Zeit: <span id="lbl-time">0</span>s</div>
            <div style="font-size: 14px;">Kills: <span id="lbl-score">0</span></div>
            <div id="slots-display"></div>
        </div>

        <a href="https://rhinogamescom.wordpress.com" class="btn-back">‚¨Ö GET BACK</a>
    </div>

    <div id="upgrade-overlay">
        <div id="upgrade-box">
            <h1 style="margin:0; color: #f1c40f; text-shadow: 2px 2px #000;">STUFENAUFSTIEG!</h1>
            <p>W√§hle eine neue F√§higkeit oder verst√§rke eine vorhandene:</p>
            <div class="card-row" id="upgrade-cards-container"></div>
        </div>
    </div>

    <script>
        /**
         * SANTI SLAYER - SUPREME ENGINE
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const WORLD_SIZE = 5000;
        let cw, ch;

        // Game State
        let player = {
            x: WORLD_SIZE/2, y: WORLD_SIZE/2,
            vx: 0, vy: 0,
            speed: 5, hp: 100, maxHp: 100,
            xp: 0, nextXp: 100, lvl: 1,
            score: 0, startTime: Date.now(),
            size: 30, angle: 0, frame: 0, slots: []
        };

        let camera = { x: 0, y: 0 };
        let keys = {};
        let enemies = [], projectiles = [], gems = [], decorations = [], effects = [];
        let gameActive = true;
        let lastShot = 0, lastLightning = 0, spawnTimer = 0;
        let mySkills = {};

        // Alle 20 Skills
        const SKILL_POOL = [
            {id:'fire', n:'Schnellfeuer', i:'üèπ'}, {id:'bolt', n:'Kettenblitz', i:'‚ö°'}, {id:'bunny', n:'Kampfhase', i:'üêá'},
            {id:'spd', n:'Fl√ºgelschuhe', i:'üëü'}, {id:'reg', n:'Regeneration', i:'üçé'}, {id:'arm', n:'R√ºstung', i:'üõ°Ô∏è'},
            {id:'aoe', n:'Sprengsatz', i:'üí£'}, {id:'mag', n:'Magnetismus', i:'üß≤'}, {id:'vamp', n:'Vampirismus', i:'üßõ'},
            {id:'ice', n:'Frosthauch', i:'‚ùÑÔ∏è'}, {id:'poi', n:'Giftnebel', i:'üß™'}, {id:'crit', n:'Pr√§zision', i:'üéØ'},
            {id:'ring', n:'Feuerring', i:'üî•'}, {id:'gold', n:'Gier', i:'üí∞'}, {id:'size', name:'Wachstum', i:'üêò'},
            {id:'mult', n:'Multischuss', i:'‚ú®'}, {id:'dash', n:'Schattenschritt', i:'üåÄ'}, {id:'shrd', n:'Splitter', i:'üíé'},
            {id:'wall', n:'Barrikade', i:'üß±'}, {id:'luck', n:'Gl√ºckspilz', i:'üçÄ'}
        ];

        // 15 Gegnertypen
        const ENEMY_TYPES = [
            {n:'Wurm', c:'#2ecc71', s:12, h:10, sp:2, t:'snake'}, {n:'Natter', c:'#27ae60', s:14, h:20, sp:2.5, t:'snake'},
            {n:'Wolf', c:'#95a5a6', s:25, h:40, sp:3.5, t:'beast'}, {n:'Eber', c:'#795548', s:30, h:70, sp:3, t:'beast'},
            {n:'Spinne', c:'#2c3e50', s:15, h:30, sp:4.5, t:'beast'}, {n:'Skorpion', c:'#d35400', s:22, h:60, sp:3, t:'beast'},
            {n:'Waldgeist', c:'#1b5e20', s:20, h:100, sp:2.2, t:'beast'}, {n:'Golem', c:'#34495e', s:50, h:400, sp:1, t:'beast'},
            {n:'Oger', c:'#145a32', s:45, h:250, sp:1.8, t:'beast'}, {n:'Schatten', c:'#000', s:20, h:150, sp:5, t:'beast'},
            {n:'D√§mon', c:'#c0392b', s:35, h:350, sp:3, t:'beast'}, {n:'Lindwurm', c:'#8e44ad', s:30, h:500, sp:2.5, t:'snake'},
            {n:'Blutwolf', c:'#641e16', s:28, h:300, sp:4.2, t:'beast'}, {n:'Hydra', c:'#196f3d', s:40, h:1000, sp:2, t:'snake'},
            {n:'SANTI-REAPER', c:'#fff', s:70, h:5000, sp:1.5, t:'boss'}
        ];

        // Setup
        function init() {
            window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
            window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
            window.addEventListener('resize', resize);
            resize();

            // Welt Deko (V2 Style)
            for(let i=0; i<150; i++) {
                decorations.push({
                    x: Math.random()*WORLD_SIZE, y: Math.random()*WORLD_SIZE,
                    t: Math.random()>0.5?'tree':'stone',
                    sz: 30+Math.random()*40
                });
            }
            updateUI();
            requestAnimationFrame(loop);
        }

        function resize() { cw = canvas.width = window.innerWidth; ch = canvas.height = window.innerHeight; }

        function spawn() {
            if(!gameActive) return;
            let elapsed = (Date.now() - player.startTime)/1000;
            let tier = Math.min(14, Math.floor(elapsed / 25));
            let type = ENEMY_TYPES[tier];

            let a = Math.random()*Math.PI*2;
            let x = player.x + Math.cos(a)*900;
            let y = player.y + Math.sin(a)*900;

            enemies.push({
                ...type, x, y, curHp: type.h, maxHp: type.h,
                segments: Array(type.t==='snake'?10:0).fill({x,y}),
                anim: Math.random()*10
            });
        }

        function triggerUpgrade() {
            gameActive = false;
            document.getElementById('upgrade-overlay').style.display = 'flex';
            const container = document.getElementById('upgrade-cards-container');
            container.innerHTML = '';

            let choices = [...SKILL_POOL].sort(() => 0.5 - Math.random()).slice(0, 3);
            choices.forEach(s => {
                let lv = mySkills[s.id] || 0;
                let div = document.createElement('div');
                div.className = 'upgrade-card';
                div.innerHTML = `<i>${s.i}</i><b>${s.n}</b><br>Rang ${lv+1}`;
                div.onclick = () => {
                    if(!mySkills[s.id]) {
                        if(player.slots.length >= 8) { alert("Slots voll!"); return; }
                        player.slots.push(s);
                    }
                    mySkills[s.id] = lv + 1;
                    if(s.id==='reg') player.hp = Math.min(player.maxHp, player.hp+25);
                    if(s.id==='size') { player.maxHp += 30; player.hp += 30; player.size += 3; }
                    
                    document.getElementById('upgrade-overlay').style.display = 'none';
                    gameActive = true;
                    updateUI();
                    window.focus();
                };
                container.appendChild(div);
            });
        }

        function updateUI() {
            document.getElementById('xp-bar-inner').style.width = (player.xp/player.nextXp*100)+'%';
            document.getElementById('hp-cur').innerText = Math.floor(player.hp);
            document.getElementById('hp-max').innerText = player.maxHp;
            document.getElementById('lbl-lvl').innerText = player.lvl;
            document.getElementById('lbl-score').innerText = player.score;
            document.getElementById('lbl-time').innerText = Math.floor((Date.now()-player.startTime)/1000);
            
            const sDiv = document.getElementById('slots-display');
            sDiv.innerHTML = '';
            player.slots.forEach(s => {
                sDiv.innerHTML += `<div class="skill-slot">${s.i}<span>${mySkills[s.id]}</span></div>`;
            });
        }

        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.rotate(player.angle);

            // Umhang
            ctx.fillStyle = '#7b241c';
            ctx.beginPath();
            ctx.moveTo(-15, 0); ctx.lineTo(-35, 20); ctx.lineTo(-35, -20); ctx.closePath(); ctx.fill();

            // K√∂rper (Detail)
            ctx.fillStyle = '#2e86c1';
            ctx.beginPath(); ctx.arc(0, 0, player.size, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#1b4f72'; ctx.lineWidth = 3; ctx.stroke();

            // Helm
            ctx.fillStyle = '#566573';
            ctx.beginPath(); ctx.arc(0, 0, player.size*0.8, Math.PI*1, Math.PI*2); ctx.fill();
            ctx.fillStyle = '#f1c40f'; // Visier
            ctx.fillRect(-10, -5, 20, 4);

            // H√§nde & Waffe (Animation)
            let wave = Math.sin(player.frame * 0.2) * 5;
            ctx.fillStyle = '#d4ac0d';
            ctx.beginPath(); ctx.arc(20, 15 + wave, 8, 0, 6.28); ctx.fill(); // Hand
            ctx.fillStyle = '#85929e';
            ctx.fillRect(20, 10 + wave, 25, 6); // Schwert/Bogen Ansatz

            ctx.restore();
        }

        function drawEnemy(en) {
            ctx.fillStyle = en.c;
            if(en.t === 'snake') {
                en.segments.forEach((seg, i) => {
                    ctx.beginPath(); ctx.arc(seg.x, seg.y, en.s*(1-i/15), 0, 6.28); ctx.fill();
                });
            } else {
                // Beast Modell
                ctx.beginPath(); ctx.arc(en.x, en.y, en.s, 0, 6.28); ctx.fill();
                // Ohren
                ctx.beginPath(); ctx.arc(en.x-en.s, en.y-en.s/2, en.s/3, 0, 6.28); ctx.fill();
                ctx.beginPath(); ctx.arc(en.x+en.s, en.y-en.s/2, en.s/3, 0, 6.28); ctx.fill();
                // Augen
                ctx.fillStyle = 'red';
                ctx.beginPath(); ctx.arc(en.x-en.s/2, en.y-5, 3, 0, 6.28); ctx.fill();
                ctx.beginPath(); ctx.arc(en.x+en.s/2, en.y-5, 3, 0, 6.28); ctx.fill();
            }
            // Health Bar
            ctx.fillStyle = '#000'; ctx.fillRect(en.x-20, en.y-en.s-15, 40, 5);
            ctx.fillStyle = '#e74c3c'; ctx.fillRect(en.x-20, en.y-en.s-15, 40*(en.curHp/en.h), 5);
        }

        function loop() {
            if(!gameActive) { requestAnimationFrame(loop); return; }

            // Movement
            let moveX = 0, moveY = 0;
            if(keys['w']) moveY = -1; if(keys['s']) moveY = 1;
            if(keys['a']) moveX = -1; if(keys['d']) moveX = 1;
            
            if(moveX !== 0 || moveY !== 0) {
                let mag = Math.hypot(moveX, moveY);
                let spd = player.speed + (mySkills.spd||0)*0.7;
                player.x += (moveX/mag)*spd;
                player.y += (moveY/mag)*spd;
                player.angle = Math.atan2(moveY, moveX);
                player.frame++;
            }

            // World Bound
            player.x = Math.max(0, Math.min(WORLD_SIZE, player.x));
            player.y = Math.max(0, Math.min(WORLD_SIZE, player.y));

            camera.x = player.x - cw/2;
            camera.y = player.y - ch/2;

            // Spawning
            spawnTimer++;
            if(spawnTimer > 50) { spawn(); spawnTimer = 0; }

            // Auto Combat (In Sichtweite)
            if(Date.now() - lastShot > 700 / (mySkills.fire||1)) {
                let nearest = null, minDist = 600;
                enemies.forEach(en => {
                    let d = Math.hypot(en.x-player.x, en.y-player.y);
                    if(d < minDist) { minDist = d; nearest = en; }
                });
                if(nearest) {
                    let a = Math.atan2(nearest.y-player.y, nearest.x-player.x);
                    projectiles.push({x:player.x, y:player.y, vx:Math.cos(a)*15, vy:Math.sin(a)*15, l:80});
                    lastShot = Date.now();
                }
            }

            // Blitz Skill
            if(mySkills.bolt && Date.now()-lastLightning > 4000/mySkills.bolt) {
                let target = enemies[Math.floor(Math.random()*enemies.length)];
                if(target && Math.hypot(target.x-player.x, target.y-player.y) < 500) {
                    target.curHp -= 25 * mySkills.bolt;
                    effects.push({x1:player.x, y1:player.y, x2:target.x, y2:target.y, t:10});
                    lastLightning = Date.now();
                }
            }

            // Logic Updates
            projectiles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.l--;
                enemies.forEach(en => {
                    if(Math.hypot(p.x-en.x, p.y-en.y) < en.s+10) {
                        en.curHp -= 10 + (mySkills.crit?Math.random()*15:0);
                        p.l = 0;
                    }
                });
                if(p.l <= 0) projectiles.splice(i, 1);
            });

            enemies.forEach((en, i) => {
                let a = Math.atan2(player.y-en.y, player.x-en.x);
                en.x += Math.cos(a)*en.sp; en.y += Math.sin(a)*en.sp;
                if(en.t === 'snake') { en.segments.unshift({x:en.x, y:en.y}); en.segments.pop(); }
                
                if(Math.hypot(player.x-en.x, player.y-en.y) < player.size+en.s) {
                    player.hp -= (0.5 / (mySkills.arm||1));
                }
                if(en.curHp <= 0) {
                    gems.push({x:en.x, y:en.y}); enemies.splice(i, 1); player.score++;
                }
            });

            gems.forEach((g, i) => {
                let d = Math.hypot(player.x-g.x, player.y-g.y);
                if(d < 150 + (mySkills.mag||0)*60) {
                    g.x += (player.x-g.x)*0.15; g.y += (player.y-g.y)*0.15;
                    if(d < 20) {
                        gems.splice(i, 1); player.xp += 30 * (mySkills.gold?1.5:1);
                        if(player.xp >= player.nextXp) {
                            player.lvl++; player.xp=0; player.nextXp*=1.3; triggerUpgrade();
                        }
                        updateUI();
                    }
                }
            });

            if(player.hp <= 0) { alert("Game Over! Kills: " + player.score); location.reload(); }

            // Render
            ctx.clearRect(0,0,cw,ch);
            ctx.save(); ctx.translate(-camera.x, -camera.y);
            
            // World
            ctx.strokeStyle='rgba(0,0,0,0.1)'; ctx.lineWidth=2;
            for(let x=0; x<WORLD_SIZE; x+=200) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,WORLD_SIZE); ctx.stroke(); }
            for(let y=0; y<WORLD_SIZE; y+=200) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(WORLD_SIZE,y); ctx.stroke(); }
            ctx.strokeStyle='red'; ctx.lineWidth=10; ctx.strokeRect(0,0,WORLD_SIZE,WORLD_SIZE);

            decorations.forEach(d => {
                ctx.fillStyle = d.t==='tree'?'#145a32':'#566573';
                ctx.beginPath(); ctx.arc(d.x, d.y, d.sz, 0, 6.28); ctx.fill();
            });

            gems.forEach(g => { ctx.fillStyle='#3498db'; ctx.beginPath(); ctx.arc(g.x, g.y, 6, 0, 6.28); ctx.fill(); });
            effects.forEach((ef, i) => { ctx.strokeStyle='cyan'; ctx.lineWidth=4; ctx.beginPath(); ctx.moveTo(ef.x1, ef.y1); ctx.lineTo(ef.x2, ef.y2); ctx.stroke(); ef.t--; if(ef.t<0) effects.splice(i,1); });
            
            drawPlayer();
            enemies.forEach(en => drawEnemy(en));
            ctx.fillStyle='#f1c40f'; projectiles.forEach(p => { ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, 6.28); ctx.fill(); });

            ctx.restore();
            requestAnimationFrame(loop);
        }

        init();
    </script>
</body>
</html>
