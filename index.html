<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer - Ultimate Pro 2026</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', Arial, sans-serif; overflow: hidden; }
        canvas { display: block; background: #27ae60; }
        #ui { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.85); padding: 20px; border-radius: 12px; border: 2px solid #f1c40f; pointer-events: none; min-width: 280px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .xp-container { width: 100%; height: 12px; background: #444; border-radius: 6px; margin: 10px 0; border: 1px solid #777; overflow: hidden; }
        #xp-bar { height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71); width: 0%; transition: width 0.4s ease-out; }
        #slots { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 15px; }
        .slot { width: 42px; height: 42px; border: 2px solid #f1c40f; background: #222; display: flex; align-items: center; justify-content: center; font-size: 22px; border-radius: 8px; position: relative; }
        .slot small { position: absolute; bottom: -2px; right: 2px; font-size: 11px; color: #fff; text-shadow: 1px 1px #000; font-weight: bold; }
        .btn-back { position: absolute; top: 20px; right: 20px; padding: 12px 24px; background: #e74c3c; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; border: 3px solid #c0392b; transition: 0.3s; z-index: 1000; pointer-events: all; }
        .btn-back:hover { background: #ff4d4d; transform: scale(1.05); }
        #upgrade-menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2c3e50; padding: 40px; border: 6px solid #f1c40f; display: none; text-align: center; border-radius: 25px; z-index: 2000; width: 650px; box-shadow: 0 0 100px rgba(0,0,0,0.8); pointer-events: all; }
        .upgrade-container { display: flex; justify-content: center; gap: 20px; }
        .upgrade-card { background: #34495e; padding: 20px; cursor: pointer; border-radius: 15px; width: 180px; transition: 0.3s; border: 2px solid transparent; }
        .upgrade-card:hover { background: #1abc9c; border-color: white; transform: translateY(-10px); }
        .upgrade-card b { display: block; margin: 10px 0; font-size: 18px; color: #f1c40f; }
        #stats { font-size: 14px; color: #bdc3c7; margin-top: 5px; }
    </style>
</head>
<body>

    <div id="ui">
        <div style="font-size: 22px; font-weight: bold; color: #f1c40f;">LEVEL <span id="lvl">1</span></div>
        <div class="xp-container"><div id="xp-bar"></div></div>
        <div id="stats">Kills: <span id="score">0</span> | Zeit: <span id="timer">0</span>s</div>
        <div style="margin-top: 10px; font-weight: bold;">HP: <span id="hpTxt" style="color: #e74c3c;">100</span> / <span id="maxHpTxt">100</span></div>
        <div id="slots"></div>
    </div>

    <a href="https://rhinogamescom.wordpress.com" class="btn-back">‚¨Ö ZUR√úCK ZU RHINO GAMES</a>

    <div id="upgrade-menu">
        <h1 style="color: #f1c40f; margin-top: 0; text-shadow: 2px 2px #000;">VERBESSERUNG W√ÑHLEN</h1>
        <p>Deine Macht w√§chst! W√§hle weise:</p>
        <div id="upgrade-options" class="upgrade-container"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        /** 
         * SANTI SLAYER - ENGINE 2026
         * Eine umfassende Rogue-lite Implementierung
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const WORLD_SIZE = 5000;
        let canvasW, canvasH;

        // --- GAME STATE ---
        let player = {
            x: WORLD_SIZE/2, y: WORLD_SIZE/2, 
            speed: 5, hp: 100, maxHp: 100, 
            xp: 0, nextXp: 100, lvl: 1, 
            score: 0, startTime: Date.now(),
            size: 28, slots: []
        };
        
        let camera = { x: 0, y: 0 };
        let keys = {};
        let enemies = [], projectiles = [], gems = [], env = [], effects = [];
        let gameActive = true;
        let lastShot = 0, lastLightning = 0;
        let mySkills = {};

        // --- INPUT MANAGER (FIX F√úR STEUERUNG) ---
        const initInput = () => {
            window.addEventListener('keydown', e => { keys[e.key.toLowerCase()] = true; });
            window.addEventListener('keyup', e => { keys[e.key.toLowerCase()] = false; });
            // Fokus-Sicherung
            window.addEventListener('mousedown', () => { if(gameActive) window.focus(); });
        };

        // --- UPGRADE DEFINITIONEN (20 ST√úCK) ---
        const ALL_SKILLS = [
            {id:'fire', name:'Tempo', icon:'üèπ'}, {id:'bolt', name:'Blitz', icon:'‚ö°'}, {id:'bunny', name:'Hase', icon:'üêá'},
            {id:'spd', name:'Schuhe', icon:'üëü'}, {id:'reg', name:'Heilung', icon:'üçé'}, {id:'arm', name:'Schild', icon:'üõ°Ô∏è'},
            {id:'aoe', name:'Bombe', icon:'üí£'}, {id:'mag', name:'Magnet', icon:'üß≤'}, {id:'vamp', name:'Vampir', icon:'üßõ'},
            {id:'ice', name:'Frost', icon:'‚ùÑÔ∏è'}, {id:'poi', name:'Gift', icon:'üß™'}, {id:'crit', name:'Krit', icon:'üéØ'},
            {id:'ring', name:'Aura', icon:'üî•'}, {id:'gold', name:'Gier', icon:'üí∞'}, {id:'size', name:'Riese', icon:'üêò'},
            {id:'mult', name:'Multi', icon:'‚ú®'}, {id:'dash', name:'Sprint', icon:'üåÄ'}, {id:'shrd', name:'Splitter', icon:'üíé'},
            {id:'wall', name:'Mauer', icon:'üß±'}, {id:'luck', name:'Gl√ºck', icon:'üçÄ'}
        ];

        // --- MAP GENERIERUNG (V2 STYLE) ---
        function initWorld() {
            for(let i=0; i<120; i++) {
                env.push({
                    x: Math.random() * WORLD_SIZE,
                    y: Math.random() * WORLD_SIZE,
                    type: Math.random() > 0.4 ? 'tree' : 'stone',
                    size: 30 + Math.random() * 40,
                    seed: Math.random() * 10
                });
            }
        }

        // --- GEGNER LOGIK (GRAPHISCH HOCHWERTIG) ---
        function spawnEnemy() {
            if(!gameActive) return;
            let time = (Date.now() - player.startTime)/1000;
            let level = Math.min(14, Math.floor(time / 20));
            
            let angle = Math.random() * Math.PI * 2;
            let dist = 800;
            let x = player.x + Math.cos(angle) * dist;
            let y = player.y + Math.sin(angle) * dist;

            const types = [
                {n:'Graswurm', col:'#2ecc71', type:'snake', hp:5},
                {n:'Waldnatter', col:'#27ae60', type:'snake', hp:12},
                {n:'Wolf', col:'#7f8c8d', type:'beast', hp:20},
                {n:'Wildschwein', col:'#a04000', type:'beast', hp:40},
                {n:'Riesenspinne', col:'#2c3e50', type:'beast', hp:30},
                {n:'Sumpfmonster', col:'#1b5e20', type:'snake', hp:60},
                {n:'Feuersalamander', col:'#e67e22', type:'snake', hp:80},
                {n:'B√§r', col:'#5d4037', type:'beast', hp:150},
                {n:'Eiswolf', col:'#d6eaf8', type:'beast', hp:100},
                {n:'Schattenl√§ufer', col:'#1a1a1a', type:'beast', hp:200},
                {n:'D√§monenschlange', col:'#c0392b', type:'snake', hp:250},
                {n:'Felsengolem', col:'#34495e', type:'beast', hp:500},
                {n:'Elite-W√§chter', col:'#f1c40f', type:'beast', hp:400},
                {n:'Hydra', col:'#8e44ad', type:'snake', hp:800},
                {n:'SANTI KILLER (BOSS)', col:'#fff', type:'boss', hp:2500}
            ];

            let t = types[level];
            enemies.push({
                ...t, x, y, curHp: t.hp, maxHp: t.hp,
                spd: 2 + Math.random() * 2,
                sz: 15 + (level * 2),
                segments: Array(t.type === 'snake' ? 10 : 0).fill({x, y}),
                anim: 0
            });
        }

        // --- UPGRADE SYSTEM ---
        function levelUp() {
            gameActive = false;
            const menu = document.getElementById('upgrade-menu');
            const container = document.getElementById('upgrade-options');
            container.innerHTML = '';
            
            let pool = [...ALL_SKILLS].sort(() => 0.5 - Math.random()).slice(0, 3);
            
            pool.forEach(skill => {
                let card = document.createElement('div');
                card.className = 'upgrade-card';
                let lv = (mySkills[skill.id] || 0);
                card.innerHTML = `<div style="font-size:45px">${skill.icon}</div><b>${skill.name}</b>Level ${lv + 1}`;
                
                card.onclick = (e) => {
                    e.stopPropagation();
                    if(!mySkills[skill.id]) {
                        if(player.slots.length < 8) player.slots.push(skill);
                        else { alert("Slots voll!"); return; }
                    }
                    mySkills[skill.id] = (mySkills[skill.id] || 0) + 1;
                    
                    // Sofort-Effekte
                    if(skill.id === 'reg') player.hp = Math.min(player.maxHp, player.hp + 30);
                    if(skill.id === 'size') { player.maxHp += 20; player.hp += 20; player.size += 2; }
                    
                    document.getElementById('upgrade-menu').style.display = 'none';
                    gameActive = true;
                    updateUI();
                    window.focus(); // Zwingt den Fokus zur√ºck f√ºr die Steuerung!
                    requestAnimationFrame(gameLoop);
                };
                container.appendChild(card);
            });
            menu.style.display = 'block';
        }

        function updateUI() {
            document.getElementById('lvl').innerText = player.lvl;
            document.getElementById('score').innerText = player.score;
            document.getElementById('hpTxt').innerText = Math.floor(player.hp);
            document.getElementById('maxHpTxt').innerText = player.maxHp;
            document.getElementById('xp-bar').style.width = (player.xp / player.nextXp * 100) + '%';
            
            const sDiv = document.getElementById('slots');
            sDiv.innerHTML = '';
            player.slots.forEach(s => {
                sDiv.innerHTML += `<div class="slot">${s.icon}<small>${mySkills[s.id]}</small></div>`;
            });
        }

        // --- RENDER FUNKTIONEN ---
        function drawWorld() {
            // Gras-Gitter
            ctx.strokeStyle = "rgba(0,0,0,0.15)";
            ctx.lineWidth = 2;
            for(let x=0; x<=WORLD_SIZE; x+=250) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, WORLD_SIZE); ctx.stroke();
            }
            for(let y=0; y<=WORLD_SIZE; y+=250) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(WORLD_SIZE, y); ctx.stroke();
            }
            
            // Border
            ctx.strokeStyle = "#c0392b";
            ctx.lineWidth = 15;
            ctx.strokeRect(0, 0, WORLD_SIZE, WORLD_SIZE);

            // Deko-Objekte
            env.forEach(o => {
                ctx.save();
                if(o.type === 'tree') {
                    ctx.fillStyle = '#145a32';
                    ctx.beginPath(); ctx.arc(o.x, o.y, o.size, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = '#1b5e20';
                    ctx.beginPath(); ctx.arc(o.x - 5, o.y - 5, o.size * 0.6, 0, Math.PI*2); ctx.fill();
                } else {
                    ctx.fillStyle = '#7f8c8d';
                    ctx.beginPath(); ctx.roundRect(o.x, o.y, o.size, o.size * 0.8, 8); ctx.fill();
                }
                ctx.restore();
            });
        }

        function drawEnemy(en) {
            ctx.fillStyle = en.col;
            en.anim += 0.1;
            
            if(en.type === 'snake') {
                en.segments.forEach((s, i) => {
                    let sSize = en.sz * (1 - i/15);
                    ctx.beginPath(); ctx.arc(s.x, s.y, sSize, 0, Math.PI*2); ctx.fill();
                    if(i === 0) { // Augen
                        ctx.fillStyle = "white";
                        ctx.beginPath(); ctx.arc(s.x-4, s.y-4, 3, 0, 6.28); ctx.fill();
                        ctx.beginPath(); ctx.arc(s.x+4, s.y-4, 3, 0, 6.28); ctx.fill();
                        ctx.fillStyle = en.col;
                    }
                });
            } else {
                // Biest-Grafik
                ctx.beginPath(); ctx.arc(en.x, en.y, en.sz, 0, Math.PI*2); ctx.fill();
                // Ohren/Details
                ctx.beginPath(); ctx.arc(en.x-en.sz, en.y-en.sz/2, en.sz/3, 0, 6.28); ctx.fill();
                ctx.beginPath(); ctx.arc(en.x+en.sz, en.y-en.sz/2, en.sz/3, 0, 6.28); ctx.fill();
                // Augen
                ctx.fillStyle = "red";
                ctx.beginPath(); ctx.arc(en.x-8, en.y-5, 4, 0, 6.28); ctx.fill();
                ctx.beginPath(); ctx.arc(en.x+8, en.y-5, 4, 0, 6.28); ctx.fill();
            }

            // HP Bar
            ctx.fillStyle = "rgba(0,0,0,0.5)";
            ctx.fillRect(en.x - 20, en.y - en.sz - 15, 40, 5);
            ctx.fillStyle = "#e74c3c";
            ctx.fillRect(en.x - 20, en.y - en.sz - 15, 40 * (en.curHp / en.maxHp), 5);
        }

        // --- HAUPTSCHLEIFE ---
        function gameLoop() {
            if(!gameActive) return;

            // Zeit-Update
            let elapsed = Math.floor((Date.now() - player.startTime) / 1000);
            document.getElementById('timer').innerText = elapsed;

            // Player Movement
            let currentSpd = player.speed + (mySkills.spd || 0) * 0.6;
            if(keys['w'] && player.y > 0) player.y -= currentSpd;
            if(keys['s'] && player.y < WORLD_SIZE) player.y += currentSpd;
            if(keys['a'] && player.x > 0) player.x -= currentSpd;
            if(keys['d'] && player.x < WORLD_SIZE) player.x += currentSpd;

            camera.x = player.x - window.innerWidth/2;
            camera.y = player.y - window.innerHeight/2;

            // Kampf-Logik (Nur Schie√üen wenn Gegner im Bild)
            let viewDist = 700;
            if(Date.now() - lastShot > 650 / (mySkills.fire || 1)) {
                let nearby = enemies.find(e => Math.hypot(e.x - player.x, e.y - player.y) < viewDist);
                if(nearby) {
                    let angle = Math.atan2(nearby.y - player.y, nearby.x - player.x);
                    projectiles.push({
                        x: player.x, y: player.y,
                        vx: Math.cos(angle) * 14,
                        vy: Math.sin(angle) * 14,
                        life: 100
                    });
                    lastShot = Date.now();
                }
            }

            // Blitz-Skill
            if(mySkills.bolt && Date.now() - lastLightning > 4000 / mySkills.bolt) {
                let target = enemies[Math.floor(Math.random() * enemies.length)];
                if(target && Math.hypot(target.x - player.x, target.y - player.y) < 600) {
                    target.curHp -= 15 * mySkills.bolt;
                    effects.push({x1: player.x, y1: player.y, x2: target.x, y2: target.y, t: 15});
                    lastLightning = Date.now();
                }
            }

            // Update Gegner
            enemies.forEach((en, i) => {
                let d = Math.hypot(player.x - en.x, player.y - en.y);
                let a = Math.atan2(player.y - en.y, player.x - en.x);
                en.x += Math.cos(a) * en.spd;
                en.y += Math.sin(a) * en.spd;

                if(en.type === 'snake') {
                    en.segments.unshift({x: en.x, y: en.y});
                    en.segments.pop();
                }

                if(d < en.sz + player.size) {
                    player.hp -= (0.4 / (mySkills.arm || 1));
                    updateUI();
                }

                if(en.curHp <= 0) {
                    gems.push({x: en.x, y: en.y, val: 20 + (levelUp * 5)});
                    enemies.splice(i, 1);
                    player.score++;
                }
            });

            // Update Gems & XP
            gems.forEach((g, i) => {
                let d = Math.hypot(player.x - g.x, player.y - g.y);
                let magnet = 120 + (mySkills.mag || 0) * 60;
                if(d < magnet) {
                    g.x += (player.x - g.x) * 0.15;
                    g.y += (player.y - g.y) * 0.15;
                    if(d < 25) {
                        player.xp += g.val * (mySkills.gold ? 1.5 : 1);
                        gems.splice(i, 1);
                        if(player.xp >= player.nextXp) {
                            player.lvl++;
                            player.xp = 0;
                            player.nextXp *= 1.3;
                            levelUp();
                        }
                        updateUI();
                    }
                }
            });

            // Projektile fliegen lassen
            projectiles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy;
                enemies.forEach(en => {
                    if(Math.hypot(p.x - en.x, p.y - en.y) < en.sz + 10) {
                        en.curHp -= 6 + (mySkills.crit && Math.random() > 0.8 ? 10 : 0);
                        projectiles.splice(i, 1);
                    }
                });
                if(p.life-- < 0) projectiles.splice(i, 1);
            });

            if(player.hp <= 0) { alert("Santi Slayer wurde besiegt! Score: " + player.score); location.reload(); }

            draw();
            requestAnimationFrame(gameLoop);
        }

        function draw() {
            canvasW = canvas.width = window.innerWidth;
            canvasH = canvas.height = window.innerHeight;
            ctx.clearRect(0, 0, canvasW, canvasH);
            
            ctx.save();
            ctx.translate(-camera.x, -camera.y);

            drawWorld();

            // Edelsteine
            ctx.fillStyle = "#3498db";
            ctx.shadowBlur = 10; ctx.shadowColor = "#3498db";
            gems.forEach(g => { ctx.beginPath(); ctx.arc(g.x, g.y, 6, 0, 6.28); ctx.fill(); });
            ctx.shadowBlur = 0;

            // Effekte
            effects.forEach((ef, i) => {
                ctx.strokeStyle = "cyan"; ctx.lineWidth = 4;
                ctx.beginPath(); ctx.moveTo(ef.x1, ef.y1); ctx.lineTo(ef.x2, ef.y2); ctx.stroke();
                ef.t--; if(ef.t < 0) effects.splice(i, 1);
            });

            // Spieler
            ctx.fillStyle = "#3498db";
            ctx.beginPath(); ctx.arc(player.x, player.y, player.size, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "white"; // "Gesicht" f√ºr Spieler
            ctx.beginPath(); ctx.arc(player.x-8, player.y-5, 4, 0, 6.28); ctx.fill();
            ctx.beginPath(); ctx.arc(player.x+8, player.y-5, 4, 0, 6.28); ctx.fill();

            // Gegner
            enemies.forEach(en => drawEnemy(en));

            // Sch√ºsse
            ctx.fillStyle = "#f1c40f";
            projectiles.forEach(p => { ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, 6.28); ctx.fill(); });

            ctx.restore();
        }

        // --- START ---
        initInput();
        initWorld();
        updateUI();
        gameLoop();

    </script>
</body>
</html>
