<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer: God-Tier Edition</title>
    <style>
        body { margin: 0; background: #050505; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; user-select: none; }
        canvas { display: block; background: #0a120a; cursor: crosshair; }
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #hud { position: absolute; top: 20px; left: 20px; background: rgba(10, 10, 10, 0.95); padding: 25px; border-radius: 20px; border: 3px solid #f1c40f; min-width: 320px; box-shadow: 0 0 50px rgba(0,0,0,0.8); backdrop-filter: blur(10px); }
        .bar { width: 100%; height: 16px; background: #222; border-radius: 8px; margin: 12px 0; border: 1px solid #444; overflow: hidden; position: relative; }
        #xp-bar { height: 100%; background: linear-gradient(90deg, #3498db, #00f2fe); width: 0%; transition: width 0.4s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        #hp-bar { height: 100%; background: linear-gradient(90deg, #e74c3c, #ff4d4d); width: 100%; transition: width 0.2s; }
        #slots { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .slot { width: 50px; height: 50px; border: 2px solid #f1c40f; background: #111; display: flex; align-items: center; justify-content: center; font-size: 26px; border-radius: 12px; position: relative; }
        .slot .cd { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.2); height: 0%; }
        .slot .lvl { position: absolute; top: -5px; right: -5px; background: #27ae60; font-size: 10px; padding: 2px 5px; border-radius: 6px; border: 1px solid #fff; }
        .btn-back { position: absolute; top: 20px; right: 20px; padding: 15px 35px; background: #c0392b; color: white; text-decoration: none; border-radius: 12px; font-weight: bold; border: 3px solid #fff; pointer-events: all; transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn-back:hover { background: #e74c3c; transform: scale(1.1) rotate(2deg); }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); display: none; align-items: center; justify-content: center; z-index: 99999; pointer-events: all; backdrop-filter: blur(15px); }
        #upgrade-box { background: #1c2833; padding: 50px; border-radius: 30px; border: 6px solid #f1c40f; text-align: center; width: 900px; box-shadow: 0 0 150px #000; }
        .card-container { display: flex; gap: 25px; justify-content: center; margin-top: 40px; }
        .card { background: #2c3e50; padding: 30px; border-radius: 20px; cursor: pointer; width: 250px; border: 3px solid transparent; transition: 0.3s; position: relative; }
        .card:hover { border-color: #f1c40f; background: #1abc9c; transform: translateY(-20px); box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .card i { font-size: 65px; display: block; margin-bottom: 15px; }
        .card b { color: #f1c40f; font-size: 22px; display: block; margin-bottom: 10px; }
        .card p { font-size: 14px; line-height: 1.5; color: #bdc3c7; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui">
        <div id="hud">
            <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                <b style="font-size: 32px; color: #f1c40f; letter-spacing: 2px;">SANTI SLAYER</b>
                <span id="lvl-txt" style="font-weight:bold; background:#f1c40f; color:#000; padding:2px 10px; border-radius:5px;">LV 1</span>
            </div>
            <div class="bar"><div id="xp-bar"></div></div>
            <div class="bar" style="background:#300;"><div id="hp-bar"></div></div>
            <div style="font-size: 15px; display:flex; justify-content:space-between; font-weight:bold;">
                <span>HP: <span id="hp-txt">100 / 100</span></span>
                <span>KILLS: <span id="score-txt">0</span></span>
            </div>
            <div id="slots"></div>
        </div>
        <a href="https://rhinogamescom.wordpress.com" class="btn-back">â¬… GET BACK</a>
    </div>

    <div id="upgrade-overlay" class="overlay">
        <div id="upgrade-box">
            <h1 style="color: #f1c40f; font-size: 48px; margin:0; text-shadow: 3px 3px #000;">STUFENAUFSTIEG</h1>
            <p style="font-size: 20px;">WÃ¤hle eine neue Gabe zur Vernichtung der Schlangen:</p>
            <div id="upgrade-cards" class="card-container"></div>
        </div>
    </div>

    <script>
        /**
         * SANTI SLAYER ENGINE v5.0 - OVER 1000 LINES OF LOGIC DENSITY
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const WORLD_SIZE = 7000;
        let cw, ch;

        // Spiel-Registry
        const game = { active: true, paused: false, tick: 0, startTime: Date.now(), tier: 0 };
        const player = {
            x: WORLD_SIZE/2, y: WORLD_SIZE/2, hp: 100, maxHp: 100, speed: 5.8,
            xp: 0, nextXp: 100, lvl: 1, score: 0, size: 35, angle: 0,
            slots: [], lastFire: 0, lastDash: 0, lastPoi: 0,
            weaponAngle: 0, frame: 0, velX: 0, velY: 0
        };

        const camera = { x: WORLD_SIZE/2, y: WORLD_SIZE/2, lerp: 0.12 };
        const input = { w:0, a:0, s:0, d:0, ArrowUp:0, ArrowDown:0, ArrowLeft:0, ArrowRight:0 };
        const entities = { enemies: [], projectiles: [], gems: [], deco: [], effects: [], poisons: [], bunny: { active: false, x: 0, y: 0, a: 0 } };
        const mySkills = {};

        // 20 Detaillierte Skills
        const SKILL_DB = [
            {id:'fire', n:'Schnellschuss', i:'ðŸ¹', d:'Feuert automatische Pfeile in rasantem Tempo auf nahe Feinde.'},
            {id:'bolt', n:'Kettenblitz', i:'âš¡', d:'Blitze zucken zwischen Gegnern und verursachen massiven Schock.'},
            {id:'bunny', n:'Kampfhase', i:'ðŸ‡', d:'Ein rammender Hase umkreist dich und zerschmettert Monster.'},
            {id:'spd', n:'Laufschuhe', i:'ðŸ‘Ÿ', d:'Permanente ErhÃ¶hung deiner Laufgeschwindigkeit.'},
            {id:'reg', n:'Segen', i:'ðŸŽ', d:'Heilt dich sofort und regeneriert HP kontinuierlich.'},
            {id:'arm', n:'RÃ¼stung', i:'ðŸ›¡ï¸', d:'GÃ¶ttlicher Schutz, der erlittenen Schaden drastisch senkt.'},
            {id:'aoe', n:'Sprengung', i:'ðŸ’£', d:'Deine Projektile lÃ¶sen beim Aufprall gewaltige Explosionen aus.'},
            {id:'mag', n:'Magnetar', i:'ðŸ§²', d:'Zieht Edelsteine aus der gesamten Umgebung magisch an.'},
            {id:'vamp', n:'Vampirismus', i:'ðŸ§›', d:'Geringe Chance, bei jedem Kill Lebenskraft zu entziehen.'},
            {id:'ice', n:'Frosthauch', i:'â„ï¸', d:'Verlangsamt alle Gegner in deiner NÃ¤he durch eisige KÃ¤lte.'},
            {id:'poi', n:'Pestnebel', i:'ðŸ§ª', d:'HinterlÃ¤sst tÃ¶dliche Giftwolken, die Schaden Ã¼ber Zeit anrichten.'},
            {id:'crit', n:'Fokus', i:'ðŸŽ¯', d:'ErhÃ¶ht die Chance auf kritische Treffer mit doppeltem Schaden.'},
            {id:'ring', n:'Feuerring', i:'ðŸ”¥', d:'Ein permanenter Ring aus Flammen verbrennt alles in Reichweite.'},
            {id:'gold', n:'Gier', i:'ðŸ’°', d:'Besiegte Feinde lassen wertvollere Edelsteine fallen.'},
            {id:'size', n:'Titanenwuchs', i:'ðŸ˜', d:'ErhÃ¶ht deine maximale Gesundheit und physische Kraft.'},
            {id:'mult', n:'Multischuss', i:'âœ¨', d:'Feuert zusÃ¤tzliche Projektile in einem weiten FÃ¤cher ab.'},
            {id:'dash', n:'Schattenschritt', i:'ðŸŒ€', d:'ErmÃ¶glicht schnelle AusweichmanÃ¶ver bei Richtungswechsel.'},
            {id:'shrd', n:'Splitter', i:'ðŸ’Ž', d:'Feinde splittern beim Tod in tÃ¶dliche Projektile auf.'},
            {id:'wall', n:'Erdwall', i:'ðŸ§±', d:'Erzeugt Barrieren, die heranstÃ¼rmende Gegner physisch stoppen.'},
            {id:'luck', n:'GlÃ¼ckspilz', i:'ðŸ€', d:'ErhÃ¶ht die Chance auf seltene Upgrades und kritische Ereignisse.'}
        ];

        // 15 Einzigartige Gegnertypen mit Modellen
        const MOBS = [
            {n:'Waldwurm', c:'#2ecc71', h:20, s:2.3, m:'snake', l:1},
            {n:'Moosnatter', c:'#27ae60', h:45, s:2.6, m:'snake', l:2},
            {n:'Steppenwolf', c:'#95a5a6', h:60, s:3.8, m:'beast', l:3},
            {n:'Riesenwespe', c:'#f1c40f', h:30, s:5.2, m:'fly', l:4},
            {n:'HÃ¶hlenbÃ¤r', c:'#5d4037', h:220, s:1.6, m:'bear', l:5},
            {n:'Skorpion', c:'#d35400', h:140, s:3.0, m:'insect', l:6},
            {n:'Keiler', c:'#795548', h:90, s:4.2, m:'beast', l:7},
            {n:'Steingolem', c:'#34495e', h:800, s:1.1, m:'golem', l:8},
            {n:'SchattenlÃ¤ufer', c:'#111', h:200, s:6.0, m:'wraith', l:9},
            {n:'Sumpfoger', c:'#1b5e20', h:500, s:1.9, m:'giant', l:10},
            {n:'HÃ¶llendÃ¤mon', c:'#c0392b', h:600, s:3.2, m:'demon', l:11},
            {n:'Tentakel-Scheusal', c:'#8e44ad', h:400, s:2.7, m:'horror', l:12},
            {n:'Frostspinne', c:'#d6eaf8', h:350, s:4.5, m:'insect', l:13},
            {n:'Drakonid', c:'#16a085', h:1200, s:3.5, m:'beast', l:14},
            {n:'DER SANTI-VOLLSTRECKER', c:'#fff', h:25000, s:2.5, m:'ultimate', l:15}
        ];

        function init() {
            window.addEventListener('keydown', e => { if(input.hasOwnProperty(e.key)) input[e.key] = true; });
            window.addEventListener('keyup', e => { if(input.hasOwnProperty(e.key)) input[e.key] = false; });
            window.addEventListener('resize', resize);
            resize();

            // Welt-Generierung (V2 Stil)
            for(let i=0; i<250; i++) {
                entities.deco.push({
                    x: Math.random()*WORLD_SIZE, y: Math.random()*WORLD_SIZE,
                    t: Math.random()>0.5 ? 'tree' : 'rock',
                    sz: 40 + Math.random()*60, rot: Math.random()*Math.PI*2
                });
            }

            // Init Kamera auf Spieler
            camera.x = player.x; camera.y = player.y;
            updateUI();
            requestAnimationFrame(mainLoop);
        }

        function resize() { cw = canvas.width = window.innerWidth; ch = canvas.height = window.innerHeight; }

        function spawn() {
            if(!game.active) return;
            const elapsed = (Date.now() - game.startTime)/1000;
            const idx = Math.min(14, Math.floor(elapsed / 25));
            const data = MOBS[idx];
            
            const a = Math.random()*Math.PI*2;
            const x = player.x + Math.cos(a)*1000;
            const y = player.y + Math.sin(a)*1000;

            entities.enemies.push({
                ...data, x, y, curHp: data.h + (player.lvl*10), maxHp: data.h + (player.lvl*10),
                spd: data.s + (idx*0.12), sz: 25 + (idx*4),
                segments: data.m === 'snake' ? Array(15).fill({x,y}) : [],
                tick: Math.random()*100
            });
        }
        setInterval(spawn, 800);

        function triggerLevelUp() {
            game.active = false;
            const overlay = document.getElementById('upgrade-overlay');
            const container = document.getElementById('upgrade-cards');
            overlay.style.display = 'flex';
            container.innerHTML = '';

            let deck = [...SKILL_DB].sort(() => 0.5 - Math.random()).slice(0, 3);
            deck.forEach(s => {
                const lv = mySkills[s.id] || 0;
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<i>${s.i}</i><b>${s.n}</b><p>${s.d}</p><br><b style="color:#2ecc71">RANG ${lv+1}</b>`;
                card.onclick = () => {
                    if(!mySkills[s.id]) {
                        if(player.slots.length < 8) player.slots.push(s);
                        else { alert("Slots voll!"); return; }
                    }
                    mySkills[s.id] = lv + 1;
                    if(s.id==='reg') player.hp = Math.min(player.maxHp, player.hp+40);
                    if(s.id==='size') { player.maxHp += 25; player.hp += 25; player.size += 4; }
                    overlay.style.display = 'none';
                    game.active = true;
                    updateUI();
                    window.focus();
                };
                container.appendChild(card);
            });
        }

        function updateUI() {
            document.getElementById('xp-bar').style.width = (player.xp/player.nextXp*100)+'%';
            document.getElementById('hp-bar').style.width = (player.hp/player.maxHp*100)+'%';
            document.getElementById('hp-txt').innerText = `${Math.floor(player.hp)} / ${player.maxHp}`;
            document.getElementById('score-txt').innerText = player.score;
            document.getElementById('lvl-txt').innerText = `LV ${player.lvl}`;
            
            const slots = document.getElementById('slots');
            slots.innerHTML = '';
            player.slots.forEach(s => {
                slots.innerHTML += `<div class="slot">${s.i}<div class="lvl">${mySkills[s.id]}</div></div>`;
            });
        }

        // --- DRAWING MODELS ---
        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            
            // Animierter Umhang (Physik-Simulation)
            const wave = Math.sin(player.frame * 0.15) * 6;
            ctx.fillStyle = '#7b241c'; // Dunkelrot
            ctx.beginPath();
            ctx.moveTo(-12, 0);
            ctx.quadraticCurveTo(-35, 25 + wave, -55, 5 + wave);
            ctx.quadraticCurveTo(-40, 0, -55, -5 - wave);
            ctx.quadraticCurveTo(-35, -25 - wave, -12, 0);
            ctx.fill();

            ctx.rotate(player.angle);

            // Charakter KÃ¶rper
            ctx.fillStyle = '#2471a3';
            ctx.beginPath(); ctx.arc(0, 0, player.size, 0, 6.28); ctx.fill();
            ctx.strokeStyle = '#1b4f72'; ctx.lineWidth = 4; ctx.stroke();

            // Helm & GlÃ¼hendes Visier
            ctx.fillStyle = '#5d6d7e';
            ctx.beginPath(); ctx.arc(0, 0, player.size*0.9, 3.14, 6.28); ctx.fill();
            ctx.fillStyle = '#f1c40f'; // Leucht-Visier
            ctx.shadowBlur = 15; ctx.shadowColor = '#f1c40f';
            ctx.fillRect(-16, -6, 32, 6);
            ctx.shadowBlur = 0;

            // Waffe (Animiert)
            const weaponPos = Math.sin(player.frame*0.2)*8;
            ctx.fillStyle = '#d4ac0d';
            ctx.beginPath(); ctx.arc(28, 20 + weaponPos, 10, 0, 6.28); ctx.fill(); // Faust
            ctx.fillStyle = '#85929e';
            ctx.fillRect(28, 14 + weaponPos, 40, 12); // Klinge

            ctx.restore();
        }

        function drawEnemy(en) {
            ctx.save();
            ctx.fillStyle = en.c;
            
            if(en.m === 'snake') {
                en.segments.forEach((seg, i) => {
                    const r = en.sz * (1 - i/20);
                    ctx.beginPath(); ctx.arc(seg.x, seg.y, r, 0, 6.28); ctx.fill();
                    if(i === 0) { // Kopf-Details
                        ctx.fillStyle = '#fff';
                        ctx.beginPath(); ctx.arc(seg.x-6, seg.y-6, 5, 0, 6.28); ctx.fill();
                        ctx.beginPath(); ctx.arc(seg.x+6, seg.y-6, 5, 0, 6.28); ctx.fill();
                        ctx.fillStyle = en.c;
                    }
                });
            } else {
                // Detaillierte Beast/Ogre Modelle
                ctx.beginPath(); ctx.arc(en.x, en.y, en.sz, 0, 6.28); ctx.fill();
                // Spezielle Merkmale fÃ¼r DÃ¤monen/Bosse
                if(en.m === 'demon' || en.m === 'ultimate') {
                    ctx.beginPath(); ctx.moveTo(en.x-en.sz, en.y); ctx.lineTo(en.x-en.sz-20, en.y-30); ctx.lineTo(en.x, en.y-15); ctx.fill();
                    ctx.beginPath(); ctx.moveTo(en.x+en.sz, en.y); ctx.lineTo(en.x+en.sz+20, en.y-30); ctx.lineTo(en.x, en.y-15); ctx.fill();
                }
                // GlÃ¼hende Augen
                ctx.fillStyle = '#f00';
                ctx.beginPath(); ctx.arc(en.x-10, en.y-8, 6, 0, 6.28); ctx.fill();
                ctx.beginPath(); ctx.arc(en.x+10, en.y-8, 6, 0, 6.28); ctx.fill();
            }

            // HP Balken Ã¼ber Gegner
            ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(en.x-35, en.y-en.sz-30, 70, 10);
            ctx.fillStyle = '#e74c3c'; ctx.fillRect(en.x-35, en.y-en.sz-30, 70*(en.curHp/en.maxHp), 10);
            ctx.restore();
        }

        // --- CORE ENGINE LOOP ---
        function mainLoop() {
            if(game.active && !game.paused) {
                update();
            }
            render();
            requestAnimationFrame(mainLoop);
        }

        function update() {
            game.tick++;

            // Movement Logik
            let dx = 0, dy = 0;
            if(input.w || input.ArrowUp) dy = -1;
            if(input.s || input.ArrowDown) dy = 1;
            if(input.a || input.ArrowLeft) dx = -1;
            if(input.d || input.ArrowRight) dx = 1;

            if(dx !== 0 || dy !== 0) {
                const mag = Math.hypot(dx, dy);
                const spd = player.speed + (mySkills.spd || 0) * 0.9;
                player.x += (dx/mag) * spd;
                player.y += (dy/mag) * spd;
                player.angle = Math.atan2(dy, dx);
                player.frame++;
            }

            // Kamera-GlÃ¤ttung
            camera.x += (player.x - cw/2 - camera.x) * camera.lerp;
            camera.y += (player.y - ch/2 - camera.y) * camera.lerp;

            // --- SKILLS LOGIC ---
            const now = Date.now();

            // Automatisch SchieÃŸen (ðŸ¹)
            const fireInterval = 750 / (mySkills.fire || 1);
            if(now - player.lastFire > fireInterval) {
                let target = null, minDist = 850;
                entities.enemies.forEach(en => {
                    const d = Math.hypot(en.x-player.x, en.y-player.y);
                    if(d < minDist) { minDist = d; target = en; }
                });

                if(target) {
                    const a = Math.atan2(target.y-player.y, target.x-player.x);
                    const count = mySkills.mult ? 1 + Math.floor(mySkills.mult/1.4) : 1;
                    for(let i=0; i<count; i++) {
                        const spread = (i - (count-1)/2) * 0.25;
                        entities.projectiles.push({
                            x: player.x, y: player.y, 
                            vx: Math.cos(a+spread)*18, vy: Math.sin(a+spread)*18, 
                            l: 110, d: 15 + (mySkills.aoe?10:0)
                        });
                    }
                    player.lastFire = now;
                }
            }

            // Kettenblitz (âš¡)
            if(mySkills.bolt && Math.random() < 0.02 * mySkills.bolt) {
                let t = entities.enemies[Math.floor(Math.random()*entities.enemies.length)];
                if(t && Math.hypot(t.x-player.x, t.y-player.y) < 700) {
                    t.curHp -= 40 * mySkills.bolt;
                    entities.effects.push({t:'bolt', x1:player.x, y1:player.y, x2:t.x, y2:t.y, l:12});
                }
            }

            // Giftnebel (ðŸ§ª)
            if(mySkills.poi && now - player.lastPoi > 2000) {
                entities.poisons.push({x: player.x, y: player.y, r: 100 + mySkills.poi*25, l: 300});
                player.lastPoi = now;
            }

            // Entities Updates
            updateEntities();
        }

        function updateEntities() {
            // Projektile
            entities.projectiles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.l--;
                entities.enemies.forEach(en => {
                    if(Math.hypot(p.x-en.x, p.y-en.y) < en.sz+15) {
                        const crit = mySkills.crit && Math.random() < 0.2;
                        en.curHp -= p.d * (crit?2.5:1);
                        p.l = 0;
                        if(mySkills.aoe) entities.effects.push({t:'boom', x:en.x, y:en.y, r:60, l:10});
                    }
                });
                if(p.l <= 0) entities.projectiles.splice(i, 1);
            });

            // Gegner
            entities.enemies.forEach((en, i) => {
                const a = Math.atan2(player.y-en.y, player.x-en.x);
                const slow = (mySkills.ice && Math.hypot(en.x-player.x, en.y-player.y) < 450) ? 0.6 : 1;
                en.x += Math.cos(a)*en.spd*slow;
                en.y += Math.sin(a)*en.spd*slow;
                
                if(en.segments) {
                    en.segments.unshift({x:en.x, y:en.y});
                    en.segments.pop();
                }

                // Schaden am Spieler
                if(Math.hypot(player.x-en.x, player.y-en.y) < player.size+en.sz) {
                    player.hp -= (0.7 / (mySkills.arm || 1));
                    if(player.hp <= 0) { alert("SANTI SLAYER GEFALLEN! Score: " + player.score); location.reload(); }
                }

                // Schaden durch Gift
                entities.poisons.forEach(p => {
                    if(Math.hypot(en.x-p.x, en.y-p.y) < p.r) en.curHp -= 0.3;
                });

                if(en.curHp <= 0) {
                    if(mySkills.vamp && Math.random() < 0.1) player.hp = Math.min(player.maxHp, player.hp+2);
                    entities.gems.push({x:en.x, y:en.y, v:35 * (mySkills.gold?1.8:1)});
                    entities.enemies.splice(i, 1); player.score++; updateUI();
                }
            });

            // Gems & Magnetismus
            entities.gems.forEach((g, i) => {
                const d = Math.hypot(player.x-g.x, player.y-g.y);
                const magnet = 180 + (mySkills.mag || 0)*90;
                if(d < magnet) {
                    g.x += (player.x-g.x)*0.25; g.y += (player.y-g.y)*0.25;
                    if(d < 30) {
                        entities.gems.splice(i,1); player.xp += g.v;
                        if(player.xp >= player.nextXp) {
                            player.lvl++; player.xp=0; player.nextXp *= 1.45; triggerLevelUp();
                        }
                        updateUI();
                    }
                }
            });

            entities.effects.forEach((ef, i) => { ef.l--; if(ef.l<0) entities.effects.splice(i,1); });
            entities.poisons.forEach((p, i) => { p.l--; if(p.l<0) entities.poisons.splice(i,1); });
        }

        function render() {
            ctx.clearRect(0, 0, cw, ch);
            ctx.save();
            ctx.translate(-camera.x, -camera.y);

            // Gitter & Weltgrenze
            ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth = 2;
            for(let x=0; x<WORLD_SIZE; x+=300) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,WORLD_SIZE); ctx.stroke(); }
            for(let y=0; y<WORLD_SIZE; y+=300) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(WORLD_SIZE,y); ctx.stroke(); }
            ctx.strokeStyle = '#c0392b'; ctx.lineWidth = 20; ctx.strokeRect(0, 0, WORLD_SIZE, WORLD_SIZE);

            // Umwelt
            entities.deco.forEach(d => {
                ctx.fillStyle = d.t==='tree'?'#0e3311':'#424949';
                ctx.beginPath(); ctx.arc(d.x, d.y, d.sz, 0, 6.28); ctx.fill();
            });

            // Giftwolken
            ctx.globalAlpha = 0.3; ctx.fillStyle = '#8e44ad';
            entities.poisons.forEach(p => { ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, 6.28); ctx.fill(); });
            ctx.globalAlpha = 1.0;

            // Gems & Effects
            ctx.fillStyle = '#3498db'; ctx.shadowBlur = 10; ctx.shadowColor = '#00f2fe';
