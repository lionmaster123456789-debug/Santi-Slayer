<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Santi Slayer - Ultimate Rogue-lite</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        canvas { background: #1b5e20; display: block; }
        #ui { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; border: 2px solid #555; pointer-events: none; }
        #slots { display: flex; gap: 5px; margin-top: 10px; }
        .slot { width: 40px; height: 40px; border: 1px solid #f1c40f; background: #333; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .btn-back { position: absolute; top: 10px; right: 10px; padding: 12px; background: #c0392b; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; z-index: 1000; border: 2px solid white; }
        #upgrade-menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2c3e50; padding: 30px; border: 5px solid #f1c40f; display: none; text-align: center; border-radius: 20px; z-index: 2000; width: 600px; }
        .upgrade-container { display: flex; justify-content: center; gap: 20px; }
        .upgrade-card { background: #34495e; padding: 15px; cursor: pointer; border-radius: 10px; width: 150px; transition: 0.2s; border: 2px solid transparent; }
        .upgrade-card:hover { background: #1abc9c; border-color: white; transform: translateY(-5px); }
        progress { width: 100%; height: 20px; }
    </style>
</head>
<body>

    <div id="ui">
        <div style="font-size: 24px; color: #f1c40f;">TIME: <span id="timer">0</span>s | KILLS: <span id="score">0</span></div>
        <div style="margin-top:5px;">HP</div>
        <progress id="hpBar" value="100" max="100"></progress>
        <div id="slots"></div>
    </div>

    <a href="https://rhinogamescom.wordpress.com" class="btn-back">â¬… ZURÃœCK</a>

    <div id="upgrade-menu">
        <h2 style="margin-top:0;">WÃ„HLE DEINE MACHT</h2>
        <div id="upgrade-options" class="upgrade-container"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const WORLD_SIZE = 4000;
        let canvasW, canvasH;
        function resize() { canvasW = canvas.width = window.innerWidth; canvasH = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();

        let player = { x: WORLD_SIZE/2, y: WORLD_SIZE/2, speed: 5, hp: 100, maxHp: 100, score: 0, startTime: Date.now(), activeSlots: [] };
        let camera = { x: 0, y: 0 };
        let keys = {};
        let enemies = [], projectiles = [], effects = [], bunny = { x: 0, y: 0, angle: 0 };
        let gameActive = true;
        let lastShot = 0, lastLightning = 0, lastRegen = 0;

        // 20 Upgrades Definition
        const UPGRADES = [
            { id: 'fireRate', name: 'Schnellfeuer', icon: 'ðŸ¹', desc: 'Schneller schieÃŸen' },
            { id: 'lightning', name: 'Blitz', icon: 'âš¡', desc: 'Trifft zufÃ¤llige Gegner' },
            { id: 'bunny', name: 'Kampfhase', icon: 'ðŸ‡', desc: 'Ein rammender Begleiter' },
            { id: 'speed', name: 'Schuhe', icon: 'ðŸ‘Ÿ', desc: '+10% Lauftempo' },
            { id: 'regen', name: 'Heilung', icon: 'ðŸŽ', desc: 'Regeneriert HP' },
            { id: 'armor', name: 'Schild', icon: 'ðŸ›¡ï¸', desc: 'Weniger Schaden' },
            { id: 'aoe', name: 'Explosion', icon: 'ðŸ’¥', desc: 'Kugeln explodieren' },
            { id: 'multishot', name: 'Multi-Pfeil', icon: 'âœ¨', desc: '+1 Projektil' },
            { id: 'poison', name: 'Gift', icon: 'ðŸ§ª', desc: 'Schaden Ã¼ber Zeit' },
            { id: 'freeze', name: 'Frost', icon: 'â„ï¸', desc: 'Verlangsamt Gegner' },
            { id: 'crit', name: 'Kritisch', icon: 'ðŸŽ¯', desc: 'Chance auf 2x Schaden' },
            { id: 'magnet', name: 'Magnet', icon: 'ðŸ§²', desc: 'XP einsammeln (Deko)' },
            { id: 'bounce', name: 'Abpraller', icon: 'ðŸ€', desc: 'Kugeln springen' },
            { id: 'shards', name: 'Splitter', icon: 'ðŸ’Ž', desc: 'Gegner splittern' },
            { id: 'aura', name: 'Feuerring', icon: 'ðŸ”¥', desc: 'Schaden um Spieler' },
            { id: 'knockback', name: 'RÃ¼ckstoÃŸ', icon: 'ðŸ¥Š', desc: 'StÃ¶ÃŸt Gegner weg' },
            { id: 'vampire', name: 'Vampir', icon: 'ðŸ§›', desc: 'Heilung bei Kill' },
            { id: 'giant', name: 'Riese', icon: 'ðŸ˜', desc: 'Mehr HP' },
            { id: 'dash', name: 'Teleport', icon: 'ðŸŒ€', desc: 'Kurzer Sprint' },
            { id: 'gold', name: 'Gier', icon: 'ðŸ’°', desc: 'Mehr Score' }
        ];

        let mySkills = {}; // Speichert Levels 1-5

        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

        function spawnEnemy() {
            if(!gameActive) return;
            let elapsed = (Date.now() - player.startTime) / 1000;
            let typeIdx = Math.min(14, Math.floor(elapsed / 20)); // Alle 20 Sek neuer Gegnertyp
            
            let angle = Math.random() * Math.PI * 2;
            let x = player.x + Math.cos(angle) * 800;
            let y = player.y + Math.sin(angle) * 800;

            const enemyTypes = [
                { n: 'Wurm', h: 2, s: 3, c: '#2ecc71', sz: 10, type: 'snake' },
                { n: 'Natter', h: 4, s: 3.2, c: '#27ae60', sz: 12, type: 'snake' },
                { n: 'Wolf', h: 8, s: 4, c: '#95a5a6', sz: 25, type: 'beast' },
                { n: 'BÃ¤r', h: 20, s: 2, c: '#5d4037', sz: 40, type: 'beast' },
                { n: 'Spinne', h: 10, s: 5, c: '#2c3e50', sz: 15, type: 'beast' },
                { n: 'Skorpion', h: 15, s: 3, c: '#d35400', sz: 20, type: 'beast' },
                { n: 'Wildschwein', h: 25, s: 4.5, c: '#795548', sz: 30, type: 'beast' },
                { n: 'Golem', h: 100, s: 1, c: '#34495e', sz: 50, type: 'beast' },
                { n: 'Schatten', h: 30, s: 6, c: '#000', sz: 20, type: 'beast' },
                { n: 'Drache', h: 150, s: 2.5, c: '#c0392b', sz: 60, type: 'snake' }
            ];

            let t = enemyTypes[typeIdx % enemyTypes.length];
            enemies.push({ ...t, x, y, hp: t.h, maxHp: t.h, segments: Array(t.type==='snake'?10:0).fill({x,y}) });
        }
        setInterval(spawnEnemy, 1000);

        function showUpgradeMenu() {
            gameActive = false;
            const container = document.getElementById('upgrade-options');
            container.innerHTML = '';
            
            // 3 zufÃ¤llige Upgrades wÃ¤hlen
            let shuffled = [...UPGRADES].sort(() => 0.5 - Math.random()).slice(0, 3);
            
            shuffled.forEach(upg => {
                let currentLv = mySkills[upg.id] || 0;
                if(currentLv < 5) {
                    let card = document.createElement('div');
                    card.className = 'upgrade-card';
                    card.innerHTML = `<div style="font-size:40px">${upg.icon}</div><h3>${upg.name}</h3><p>Level ${currentLv+1}</p>`;
                    card.onclick = () => {
                        if(!mySkills[upg.id] && player.activeSlots.length >= 8) {
                            alert("Slots voll!"); return;
                        }
                        if(!mySkills[upg.id]) player.activeSlots.push(upg);
                        mySkills[upg.id] = currentLv + 1;
                        updateUI();
                        gameActive = true;
                        document.getElementById('upgrade-menu').style.display = 'none';
                        window.focus();
                    };
                    container.appendChild(card);
                }
            });
            document.getElementById('upgrade-menu').style.display = 'block';
        }

        function updateUI() {
            const sDiv = document.getElementById('slots');
            sDiv.innerHTML = '';
            player.activeSlots.forEach(s => {
                sDiv.innerHTML += `<div class="slot" title="${s.name}">${s.icon}<small>${mySkills[s.id]}</small></div>`;
            });
        }

        function update() {
            if(!gameActive) return;
            let time = Math.floor((Date.now() - player.startTime) / 1000);
            document.getElementById('timer').innerText = time;

            // Player Bewegung & Border Check
            let speed = player.speed + (mySkills.speed || 0);
            if(keys['w'] && player.y > 0) player.y -= speed;
            if(keys['s'] && player.y < WORLD_SIZE) player.y += speed;
            if(keys['a'] && player.x > 0) player.x -= speed;
            if(keys['d'] && player.x < WORLD_SIZE) player.x += speed;

            camera.x = player.x - canvasW/2;
            camera.y = player.y - canvasH/2;

            // Blitz Skill Logik
            if(mySkills.lightning && Date.now() - lastLightning > (4000 / mySkills.lightning)) {
                let target = enemies[Math.floor(Math.random()*enemies.length)];
                if(target) {
                    target.hp -= (2 * mySkills.lightning);
                    effects.push({ x: player.x, y: player.y, tx: target.x, ty: target.y, life: 10, type: 'bolt' });
                    lastLightning = Date.now();
                }
            }

            // Hasen Logik
            if(mySkills.bunny) {
                bunny.angle += 0.05;
                bunny.x = player.x + Math.cos(bunny.angle) * 150;
                bunny.y = player.y + Math.sin(bunny.angle) * 150;
                enemies.forEach(en => {
                    if(Math.hypot(bunny.x - en.x, bunny.y - en.y) < 40) en.hp -= 0.1 * mySkills.bunny;
                });
            }

            // SchieÃŸen
            if(Date.now() - lastShot > (500 / (mySkills.fireRate || 1))) {
                let target = enemies[0];
                if(target) {
                    let angle = Math.atan2(target.y - player.y, target.x - player.x);
                    projectiles.push({ x: player.x, y: player.y, vx: Math.cos(angle)*12, vy: Math.sin(angle)*12 });
                }
                lastShot = Date.now();
            }

            // Enemies Update
            enemies.forEach((en, i) => {
                let angle = Math.atan2(player.y - en.y, player.x - en.x);
                en.x += Math.cos(angle) * en.speed;
                en.y += Math.sin(angle) * en.speed;

                if(en.type === 'snake') {
                    en.segments.unshift({x: en.x, y: en.y}); en.segments.pop();
                }

                if(Math.hypot(player.x - en.x, player.y - en.y) < en.sz + 10) {
                    player.hp -= (0.5 / (mySkills.armor || 1));
                    document.getElementById('hpBar').value = player.hp;
                }

                projectiles.forEach((p, pi) => {
                    if(Math.hypot(p.x - en.x, p.y - en.y) < en.sz + 10) {
                        en.hp -= 2; projectiles.splice(pi, 1);
                    }
                });

                if(en.hp <= 0) {
                    enemies.splice(i, 1); player.score++;
                    document.getElementById('score').innerText = player.score;
                    if(player.score % 10 === 0) showUpgradeMenu();
                }
            });

            if(player.hp <= 0) location.reload();

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvasW, canvasH);
            ctx.save(); ctx.translate(-camera.x, -camera.y);

            // World Border
            ctx.strokeStyle = "red"; ctx.lineWidth = 10;
            ctx.strokeRect(0, 0, WORLD_SIZE, WORLD_SIZE);

            // Hase Zeichnen
            if(mySkills.bunny) {
                ctx.fillStyle = "white";
                ctx.beginPath(); ctx.arc(bunny.x, bunny.y, 15, 0, Math.PI*2); ctx.fill();
                ctx.fillRect(bunny.x-5, bunny.y-25, 4, 15); ctx.fillRect(bunny.x+1, bunny.y-25, 4, 15); // Ohren
            }

            // Blitz Effekte
            effects.forEach((eff, i) => {
                if(eff.type === 'bolt') {
                    ctx.strokeStyle = "cyan"; ctx.lineWidth = 3;
                    ctx.beginPath(); ctx.moveTo(eff.x, eff.y); ctx.lineTo(eff.tx, eff.ty); ctx.stroke();
                }
                eff.life--; if(eff.life <= 0) effects.splice(i, 1);
            });

            // Player
            ctx.fillStyle = "#3498db";
            ctx.beginPath(); ctx.arc(player.x, player.y, 25, 0, Math.PI*2); ctx.fill();

            // Gegner
            enemies.forEach(en => {
                ctx.fillStyle = en.c;
                if(en.type === 'snake') {
                    en.segments.forEach((s, j) => {
                        ctx.beginPath(); ctx.arc(s.x, s.y, en.sz * (1 - j/15), 0, Math.PI*2); ctx.fill();
                    });
                } else {
                    ctx.beginPath(); ctx.arc(en.x, en.y, en.sz, 0, Math.PI*2); ctx.fill();
                    // Augen fÃ¼r BÃ¤ren/WÃ¶lfe
                    ctx.fillStyle = "red";
                    ctx.circle(en.x-10, en.y-5, 3); ctx.circle(en.x+10, en.y-5, 3);
                    ctx.fillStyle = en.c;
                }
            });

            // Projektile
            ctx.fillStyle = "yellow";
            projectiles.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, Math.PI*2); ctx.fill();
            });

            ctx.restore();
        }
        
        // Helfer
        ctx.circle = function(x,y,r) { this.beginPath(); this.arc(x,y,r,0,Math.PI*2); this.fill(); }

        update();
    </script>
</body>
</html>
