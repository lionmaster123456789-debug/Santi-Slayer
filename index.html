<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santi Slayer - Rogue-lite</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        canvas { background: #2c3e50; display: block; border: 3px solid #7f8c8d; cursor: crosshair; }
        #ui { position: absolute; top: 10px; left: 10px; pointer-events: none; }
        .btn-back { position: absolute; top: 10px; right: 10px; padding: 10px 20px; background: #e74c3c; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; }
        #upgrade-menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); padding: 20px; border-radius: 10px; display: none; text-align: center; pointer-events: all; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; background: #27ae60; border: none; color: white; font-weight: bold; }
    </style>
</head>
<body>

    <div id="ui">
        <div>Kills: <span id="score">0</span></div>
        <div>HP: <span id="hp">100</span></div>
    </div>

    <a href="https://rhinogamescom.wordpress.com" class="btn-back">Get Back</a>

    <canvas id="gameCanvas"></canvas>

    <div id="upgrade-menu">
        <h2>Upgrade w√§hlen!</h2>
        <button onclick="upgrade('damage')">Schaden +1</button>
        <button onclick="upgrade('speed')">Tempo +1</button>
        <button onclick="upgrade('hp')">Heilen +20</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let player = { x: canvas.width/2, y: canvas.height/2, size: 20, speed: 4, hp: 100, damage: 1 };
        let projectiles = [];
        let enemies = [];
        let score = 0;
        let keys = {};
        let gameActive = true;

        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
        window.addEventListener('mousedown', shoot);

        function shoot(e) {
            if(!gameActive) return;
            const angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
            projectiles.push({ x: player.x, y: player.y, vx: Math.cos(angle) * 7, vy: Math.sin(angle) * 7 });
        }

        function spawnEnemy() {
            if(!gameActive) return;
            const edge = Math.floor(Math.random() * 4);
            let x, y;
            if(edge === 0) { x = Math.random() * canvas.width; y = -20; }
            else if(edge === 1) { x = canvas.width + 20; y = Math.random() * canvas.height; }
            else if(edge === 2) { x = Math.random() * canvas.width; y = canvas.height + 20; }
            else { x = -20; y = Math.random() * canvas.height; }
            enemies.push({ x, y, size: 10, speed: 2, hp: 1 });
        }
        setInterval(spawnEnemy, 1000);

        function upgrade(type) {
            if(type === 'damage') player.damage += 1;
            if(type === 'speed') player.speed += 0.5;
            if(type === 'hp') player.hp = Math.min(100, player.hp + 20);
            document.getElementById('upgrade-menu').style.display = 'none';
            gameActive = true;
            requestAnimationFrame(update);
        }

        function update() {
            if(!gameActive) return;

            // Bewegung
            if(keys['w'] && player.y > 0) player.y -= player.speed;
            if(keys['s'] && player.y < canvas.height) player.y += player.speed;
            if(keys['a'] && player.x > 0) player.x -= player.speed;
            if(keys['d'] && player.x < canvas.width) player.x += player.speed;

            // Projectiles
            projectiles.forEach((p, pi) => {
                p.x += p.vx; p.y += p.vy;
                if(p.x < 0 || p.x > canvas.width || p.y < 0 || p.y > canvas.height) projectiles.splice(pi, 1);
            });

            // Enemies
            enemies.forEach((en, ei) => {
                const angle = Math.atan2(player.y - en.y, player.x - en.x);
                en.x += Math.cos(angle) * en.speed;
                en.y += Math.sin(angle) * en.speed;

                // Collision Player-Enemy (Schlangen-Attacke)
                const dist = Math.hypot(player.x - en.x, player.y - en.y);
                if(dist < player.size) {
                    player.hp -= 0.5;
                    if(player.hp <= 0) location.reload(); // Restart bei Tod
                }

                // Collision Projectile-Enemy
                projectiles.forEach((p, pi) => {
                    if(Math.hypot(p.x - en.x, p.y - en.y) < 15) {
                        enemies.splice(ei, 1);
                        projectiles.splice(pi, 1);
                        score++;
                        if(score % 10 === 0) { // Upgrade alle 10 Kills
                            gameActive = false;
                            document.getElementById('upgrade-menu').style.display = 'block';
                        }
                    }
                });
            });

            draw();
            document.getElementById('score').innerText = score;
            document.getElementById('hp').innerText = Math.floor(player.hp);
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Player
            ctx.fillStyle = '#3498db';
            ctx.beginPath(); ctx.arc(player.x, player.y, player.size, 0, Math.PI*2); ctx.fill();
            // Projectiles
            ctx.fillStyle = 'yellow';
            projectiles.forEach(p => { ctx.beginPath(); ctx.arc(p.x, p.y, 5, 0, Math.PI*2); ctx.fill(); });
            // Enemies (Kleine Schlangen/Punkte)
            ctx.fillStyle = '#2ecc71';
            enemies.forEach(en => { ctx.beginPath(); ctx.arc(en.x, en.y, en.size, 0, Math.PI*2); ctx.fill(); });
        }

        update();
    </script>
</body>
</html>
